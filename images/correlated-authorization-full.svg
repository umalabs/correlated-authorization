<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2281" height="1839"><desc>participant%20%22AuthZ%20Server%20%E2%80%93%20Requesting%20Party%20(AS-RqP)%22%20as%20AS-RqP%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22AuthZ%20Server%20%E2%80%93%20Resource%20Owner%20(AS-RO)%22%20as%20AS-RO%0A%0Abottomparticipants%0A%0Anote%20over%20AS-RqP%3AAS-RqP%3A%5Cn%E2%80%A2%20supports%20the%20token%20exchange%20extension%20of%20OAuth2%5Cn%E2%80%A2%20publishes%20its%20metadata%20on%20a%20URL%20%2F.well-known%2Foauth-authorization-server%5Cn%E2%80%A2%20also%20acts%20as%20RqP's%20Identity%20Provider%0Anote%20over%20Client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20AS-RqP%20as%20a%20public%20or%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20Relying%20Party%20in%20a%20RqP's%20Identity%20Provider%20in%20order%20to%20obtain%20an%20an%20access_token_with_user_claims%5Cn%E2%80%A2%20should%20be%20registered%20at%20AS-RO%20as%20a%20public%20or%20confidential%20client%3B%20in%20case%20of%20immediate%20access%2C%5Cn%20%20%20the%20client%20does%20not%20have%20to%20be%20registered%20at%20AS-RO%0Anote%20over%20RS%3ARO%20has%20set%20up%20RS%20and%20registers%20his%20resource%20at%20AS-RO%20to%20get%20resource_uri%20and%20sets%20policies%5Cnto%20the%20resource%20sets%20with%20the%20authorization%20server%20to%20indicate%20who%20can%20access%20the%20resources.%0ARS%3C-Client%3A1.%20Send%20HTTP%20request%20to%20resource_uri%20with%20no%20access%20token%0ARS-%3EAS-RO%3A2.%20Request%20a%20permission%20ticket%0Anote%20over%20AS-RO%3A%20AS-RO%20generates%20the%20permission%20ticket%20itself%20(ticket%20is%20a%20random%20NONCE)%20and%20the%20permission%20token%2C%5Cnwhich%20is%20bound%20to%20the%20permission%20ticket%20through%20a%20permission%20ticket%20hash.%5CnThe%20permission%20token%20contains%20these%20claims%3A%5Cn%7Bissuer%2C%20ts%2C%20audience%2C%20resource_uri_hash%2C%20permission_ticket_hash%7D%5Cnwhere%5Cnissuer%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20permission%20token%5Cnts%20is%20the%20timestamp%20of%20when%20the%20permission%20ticket%20was%20created%5Cnaudience%20is%20the%20URI%20that%20identifies%20the%20resource%20server%5Cnresource_uri_hash%20%3D%20Base64URL-Encode(SHA256(resource_uri))%5Cnpermission_ticket_hash%20%3D%20Base64URL-Encode(SHA256(permission_ticket))%0ARS%3C-AS-RO%3A3.%20Return%20the%20permission%20ticket%20and%20the%20permission%20token%0ARS-%3EClient%3A4.%20Return%20401%20with%20the%20permission%20ticket%20and%20the%20permission%20token%0AAS-RqP%3C-Client%3A5.%20Request%20a%20claims%20token%20(token%20exchange%20request)%5Cn%20%20%20%20%7Bgrant_type%20%3D%20token-exchange%2C%5Cn%20%20%20%20%20resource%20%3D%20resource_uri%2C%5Cn%20%20%20%20%20scope%20%3D%20permission_token%2C%5Cn%20%20%20%20%20subject_token%20%3D%20access_token_with_user_claims%2C%5Cn%20%20%20%20%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%2C%5Cn%20%20%20%20%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%7D%0Agroup%20Authorization%20assessment%0Anote%20over%20AS-RqP%3A1.%20verify%20permission_token%20signature%5Cn2.%20extract%20resource_uri_hash%20claim%20from%20permission_token%5Cn3.%20compare%20resource_uri_hash%20vs.%20Base64URL-Encode(SHA256(resource_uri))%5Cn4.%20evaluate%20issuer%2C%20ts%2C%20audience%2C%20resource_uri%0Aend%0Anote%20over%20AS-RqP%3AAS-RqP%20generates%20the%20claim%20token%2C%20which%20contains%20these%20claims%3A%5Cn%7Buser_claims%2C%20permission_ticket_hash%7D%5Cnwhere%5Cnuser_claims%20are%20extracted%20from%20access_token_with_user_claims%5Cnpermission_ticket_hash%20is%20extracted%20from%20permission_token%0AClient%3C-AS-RqP%3A6.%20Return%20claims%20token%5Cn%20%20%20%20%7Bclaims_token%7D%0A%0AClient-%3EAS-RO%3A7.%20Request%20a%20Requesting%20Party%20Token%20(RPT)%5Cn%20%20%20%20%7Bgrant_type%20%3D%20uma-ticket%2C%5Cn%20%20%20%20%20pushed_claims%20%3D%20claims_token%7D%0Agroup%20Authorization%20assessment%0Anote%20over%20AS-RO%3A1.%20verify%20permission_ticket%5Cn2.%20extract%20user_claims%20from%20claims_token%5Cn3.%20select%20email_address%20claim%5Cn4.%20bootstrap%20discovery%20of%20AS-RqP%20config%20url%20from%20email%20address%20via%20WebFinger%3B%5Cn%20%20%20%20if%20this%20doesn't%20work%2C%20build%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20evaluate%20resource_uri%5Cn7.%20extract%20permission_ticket_hash%20claim%20from%20claims_token%5Cn8.%20compare%20permission_ticket_hash%20vs.%20Base64URL-Encode(SHA256(permission_ticket))%5Cn9.%20evaluate%20user_claims%0Aend%0AClient%3C-AS-RO%3A8.%20Return%20RPT%20(If%20applicable%2C%20JWT%20with%20resource%20provenance%20and%20resource%20authenticity%20claims)%5Cn%20%20%20%20%7BRPT%7D%0ARS%3C-Client%3A9.%20Send%20HTTP%20request%20to%20resource_uri%5Cn%20%20%20%20%7BRPT%7D%0ARS-%3EClient%3A10.%20Return%20HTTP%20response%20typically%20with%20200%2C%20201%20status%20code%0AClient-%3EClient%3A11.%20If%20applicable%2C%20verify%20the%20resource%20provenance%20and%20authenticity</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2281" height="1839"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 326.1780948870312 50.815047804 L 326.1780948870312 1786.367570724" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 904.8545008917187 50.815047804 L 904.8545008917187 1786.367570724" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1431.3308946893749 50.815047804 L 1431.3308946893749 1786.367570724" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1889.3406136823437 50.815047804 L 1889.3406136823437 1786.367570724" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 156.00109485561714 10.253481456000003 L 496.3550949184453 10.253481456000003 L 496.3550949184453 50.815047804 L 156.00109485561714 50.815047804 L 156.00109485561714 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="172.36142923761713" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 867.2441665097186 10.253481456000003 L 942.4648352737187 10.253481456000003 L 942.4648352737187 50.815047804 L 867.2441665097186 50.815047804 L 867.2441665097186 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="883.6045008917187" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1337.103891606203 10.253481456000003 L 1525.5578977725468 10.253481456000003 L 1525.5578977725468 50.815047804 L 1337.103891606203 50.815047804 L 1337.103891606203 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1353.464225988203" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1724.8302854038593 10.253481456000003 L 2053.850941960828 10.253481456000003 L 2053.850941960828 50.815047804 L 1724.8302854038593 50.815047804 L 1724.8302854038593 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1741.1906197858593" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 156.00109485561714 1786.367570724 L 496.3550949184453 1786.367570724 L 496.3550949184453 1826.929137072 L 156.00109485561714 1826.929137072 L 156.00109485561714 1786.367570724 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="172.36142923761713" y="1811.850487872" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 867.2441665097186 1786.367570724 L 942.4648352737187 1786.367570724 L 942.4648352737187 1826.929137072 L 867.2441665097186 1826.929137072 L 867.2441665097186 1786.367570724 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="883.6045008917187" y="1811.850487872" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1337.103891606203 1786.367570724 L 1525.5578977725468 1786.367570724 L 1525.5578977725468 1826.929137072 L 1337.103891606203 1826.929137072 L 1337.103891606203 1786.367570724 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1353.464225988203" y="1811.850487872" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1724.8302854038593 1786.367570724 L 2053.850941960828 1786.367570724 L 2053.850941960828 1826.929137072 L 1724.8302854038593 1826.929137072 L 1724.8302854038593 1786.367570724 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1741.1906197858593" y="1811.850487872" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 30.184654708203098 80.972346204 L 608.6007507858593 80.972346204 L 622.1715350658593 94.543130484 L 622.1715350658593 160.889186964 L 30.184654708203098 160.889186964 L 30.184654708203098 80.972346204 M 608.6007507858593 80.972346204 L 608.6007507858593 94.543130484 L 622.1715350658593 94.543130484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="51.29476358820307" y="102.082455084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="51.29476358820307" y="117.161104284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the token exchange extension of OAuth2</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="51.29476358820307" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• publishes its metadata on a URL /.well-known/oauth-authorization-server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="51.29476358820307" y="147.318402684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• also acts as RqP's Identity Provider</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 486.1527172070312 183.507160764 L 1309.9855002964061 183.507160764 L 1323.5562845764061 197.077945044 L 1323.5562845764061 278.502650724 L 486.1527172070312 278.502650724 L 486.1527172070312 183.507160764 M 1309.9855002964061 183.507160764 L 1309.9855002964061 197.077945044 L 1323.5562845764061 197.077945044" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.26282608703116" y="204.61726964399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.26282608703116" y="219.69591884399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at AS-RqP as a public or confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.26282608703116" y="234.77456804399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a Relying Party in a RqP's Identity Provider in order to obtain an an access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.26282608703116" y="249.85321724399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should be registered at AS-RO as a public or confidential client; in case of immediate access,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="507.26282608703116" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the client does not have to be registered at AS-RO</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1072.2291171082031 301.120624524 L 1776.8618879905468 301.120624524 L 1790.4326722705468 314.691408804 L 1790.4326722705468 350.880166884 L 1072.2291171082031 350.880166884 L 1072.2291171082031 301.120624524 M 1776.8618879905468 301.120624524 L 1776.8618879905468 314.691408804 L 1790.4326722705468 314.691408804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1093.339225988203" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RO has set up RS and registers his resource at AS-RO to get resource_uri and sets policies</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1093.339225988203" y="337.309382604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to the resource sets with the authorization server to indicate who can access the resources.</text></g><g><g><rect fill="white" stroke="none" x="950.2308943070311" y="373.498140684" width="435.72360696703123" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="952.4926916870311" y="387.0689249640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send HTTP request to resource_uri with no access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 904.8545008917187 393.10038464400003 L 1418.9161401813749 393.10038464400003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1431.3308946893749,393.10038464400003) translate(-1431.3308946893749,-393.10038464400003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1418.765353689375 386.817614144 L 1431.3308946893749 393.10038464400003 L 1418.765353689375 399.38315514400006 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1547.0322926823242" y="415.71835844400005" width="226.60692300707032" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1549.2940900623241" y="429.28914272400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Request a permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1431.3308946893749 435.32060240400006 L 1876.9258591743437 435.32060240400006" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1889.3406136823437,435.32060240400006) translate(-1889.3406136823437,-435.32060240400006)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1876.7750726823438 429.03783190400003 L 1889.3406136823437 435.32060240400006 L 1876.7750726823438 441.6033729040001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1504.8138483082032 457.93857620400007 L 2260.296594776484 457.93857620400007 L 2273.8673790564844 471.50936048400007 L 2273.8673790564844 628.3273121640001 L 1504.8138483082032 628.3273121640001 L 1504.8138483082032 457.93857620400007 M 2260.296594776484 457.93857620400007 L 2260.296594776484 471.50936048400007 L 2273.8673790564844 471.50936048400007" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="479.0486850840001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RO generates the permission ticket itself (ticket is a random NONCE) and the permission token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="494.1273342840001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">which is bound to the permission ticket through a permission ticket hash.</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="509.20598348400006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The permission token contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="524.284632684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{issuer, ts, audience, resource_uri_hash, permission_ticket_hash}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="539.363281884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="554.441931084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">issuer is the URI that identifies who issues the permission token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="569.520580284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ts is the timestamp of when the permission ticket was created</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="584.5992294839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">audience is the URI that identifies the resource server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="599.6778786839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">resource_uri_hash = Base64URL-Encode(SHA256(resource_uri))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1525.923957188203" y="614.7565278839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">permission_ticket_hash = Base64URL-Encode(SHA256(permission_ticket))</text></g><g><g><rect fill="white" stroke="none" x="1449.173962909375" y="650.945285964" width="422.32358255296873" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1451.435760289375" y="664.516070244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Return the permission ticket and the permission token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1889.3406136823437 670.5475299240001 L 1443.7456491973749 670.5475299240001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1431.3308946893749,670.5475299240001) translate(-1431.3308946893749,-670.5475299240001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1443.8964356893748 664.2647594240001 L 1431.3308946893749 670.5475299240001 L 1443.8964356893748 676.830300424 Z"/></g></g><g><g><rect fill="white" stroke="none" x="922.6975691117186" y="693.165503724" width="490.79025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="924.9593664917186" y="706.736288004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return 401 with the permission ticket and the permission token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1431.3308946893749 712.767747684 L 917.2692553997186 712.767747684" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(904.8545008917187,712.767747684) translate(-904.8545008917187,-712.767747684)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 917.4200418917187 706.4849771840001 L 904.8545008917187 712.767747684 L 917.4200418917187 719.050518184 Z"/></g></g><g><g><rect fill="white" stroke="none" x="344.0211631070312" y="735.3857214840001" width="387.4402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="344.0211631070312" y="750.4643706840001" width="255.84026040941407" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="344.0211631070312" y="765.543019884" width="207.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="344.0211631070312" y="780.621669084" width="225.74025430589845" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="344.0211631070312" y="795.700318284" width="385.85693826585936" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="344.0211631070312" y="810.778967484" width="542.9902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="344.0211631070312" y="825.8576166839999" width="492.6236008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="346.28296048703123" y="748.9565057640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Request a claims token (token exchange request)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="346.28296048703123" y="764.0351549640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = token-exchange,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="346.28296048703123" y="779.113804164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     resource = resource_uri,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="346.28296048703123" y="794.192453364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     scope = permission_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="346.28296048703123" y="809.271102564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token = access_token_with_user_claims,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="346.28296048703123" y="824.349751764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token_type = urn:ietf:params:oauth:token-type:access_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="346.28296048703123" y="839.4284009639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     requested_token_type = urn:ietf:params:oauth:token-type:jwt}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 904.8545008917187 845.4598606440001 L 338.5928493950312 845.4598606440001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(326.1780948870312,845.4598606440001) translate(-326.1780948870312,-845.4598606440001)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 338.7436358870312 839.1770901440001 L 326.1780948870312 845.4598606440001 L 338.7436358870312 851.742631144 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 22.617973799999973 908.790187284 L 616.1674316940624 908.790187284 L 629.7382159740624 922.360971564 L 629.7382159740624 988.707028044 L 22.617973799999973 988.707028044 L 22.617973799999973 908.790187284 M 616.1674316940624 908.790187284 L 616.1674316940624 922.360971564 L 629.7382159740624 922.360971564" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="929.900296164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify permission_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="944.978945364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. extract resource_uri_hash claim from permission_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="960.0575945639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. compare resource_uri_hash vs. Base64URL-Encode(SHA256(resource_uri))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="975.1362437639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. evaluate issuer, ts, audience, resource_uri</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 69.30132340937497 1033.942975644 L 569.4840820846874 1033.942975644 L 583.0548663646874 1047.513759924 L 583.0548663646874 1128.938465604 L 69.30132340937497 1128.938465604 L 69.30132340937497 1033.942975644 M 569.4840820846874 1033.942975644 L 569.4840820846874 1047.513759924 L 583.0548663646874 1047.513759924" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.41143228937494" y="1055.0530845239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP generates the claim token, which contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.41143228937494" y="1070.1317337239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{user_claims, permission_ticket_hash}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.41143228937494" y="1085.2103829239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.41143228937494" y="1100.2890321239997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">user_claims are extracted from access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="90.41143228937494" y="1115.3676813239997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">permission_ticket_hash is extracted from permission_token</text></g><g><g><rect fill="white" stroke="none" x="530.812834859961" y="1151.5564394039998" width="169.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="530.812834859961" y="1166.6350886039997" width="137.39026346117188" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="533.0746322399609" y="1165.1272236839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Return claims token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="533.0746322399609" y="1180.2058728839997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {claims_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 326.1780948870312 1186.2373325639999 L 892.4397463837187 1186.2373325639999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(904.8545008917187,1186.2373325639999) translate(-904.8545008917187,-1186.2373325639999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 892.2889598917186 1179.954562064 L 904.8545008917187 1186.2373325639999 L 892.2889598917186 1192.5201030639998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1238.9607599070312" y="1208.8553063639997" width="316.27359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1238.9607599070312" y="1223.9339555639997" width="216.85692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1238.9607599070312" y="1239.0126047639997" width="262.77359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1241.2225572870311" y="1222.4260906439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Request a Requesting Party Token (RPT)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1241.2225572870311" y="1237.5047398439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = uma-ticket,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1241.2225572870311" y="1252.5833890439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     pushed_claims = claims_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 904.8545008917187 1258.6148487239998 L 1876.9258591743437 1258.6148487239998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1889.3406136823437,1258.6148487239998) translate(-1889.3406136823437,-1258.6148487239998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1876.7750726823438 1252.3320782239998 L 1889.3406136823437 1258.6148487239998 L 1876.7750726823438 1264.8976192239998 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1547.8804986988282 1321.9451753639999 L 2217.229944385859 1321.9451753639999 L 2230.8007286658594 1335.5159596439998 L 2230.8007286658594 1492.333911324 L 1547.8804986988282 1492.333911324 L 1547.8804986988282 1321.9451753639999 M 2217.229944385859 1321.9451753639999 L 2217.229944385859 1335.5159596439998 L 2230.8007286658594 1335.5159596439998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1343.055284244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify permission_ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1358.133933444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1373.212582644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1388.2912318439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. bootstrap discovery of AS-RqP config url from email address via WebFinger;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1403.3698810439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    if this doesn't work, build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1418.4485302439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1433.5271794439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. evaluate resource_uri</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1448.6058286439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract permission_ticket_hash claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1463.6844778439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. compare permission_ticket_hash vs. Base64URL-Encode(SHA256(permission_ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1568.990607578828" y="1478.7631270439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate user_claims</text></g><g><g><rect fill="white" stroke="none" x="1053.452428608203" y="1537.5698589239998" width="687.2902573576563" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1053.452428608203" y="1552.6485081239998" width="69.87359323412109" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.714225988203" y="1551.1406432039998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return RPT (If applicable, JWT with resource provenance and resource authenticity claims)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1055.714225988203" y="1566.2192924039998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {RPT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1889.3406136823437 1572.250752084 L 917.2692553997186 1572.250752084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(904.8545008917187,1572.250752084) translate(-904.8545008917187,-1572.250752084)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 917.4200418917187 1565.967981584 L 904.8545008917187 1572.250752084 L 917.4200418917187 1578.533522584 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1029.5142347611327" y="1594.8687258839998" width="277.1569260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1029.5142347611327" y="1609.9473750839998" width="69.87359323412109" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1031.7760321411326" y="1608.4395101639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Send HTTP request to resource_uri</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1031.7760321411326" y="1623.5181593639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {RPT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 904.8545008917187 1629.5496190439999 L 1418.9161401813749 1629.5496190439999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1431.3308946893749,1629.5496190439999) translate(-1431.3308946893749,-1629.5496190439999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1418.765353689375 1623.266848544 L 1431.3308946893749 1629.5496190439999 L 1418.765353689375 1635.8323895439999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="939.6975691117186" y="1652.167592844" width="456.79025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="941.9593664917186" y="1665.738377124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return HTTP response typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1431.3308946893749 1671.7698368039999 L 917.2692553997186 1671.7698368039999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(904.8545008917187,1671.7698368039999) translate(-904.8545008917187,-1671.7698368039999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 917.4200418917187 1665.4870663039999 L 904.8545008917187 1671.7698368039999 L 917.4200418917187 1678.0526073039998 Z"/></g></g><g><g><rect fill="white" stroke="none" x="922.6975691117187" y="1694.387810604" width="485.72360696703123" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="924.9593664917187" y="1707.958594884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">11. If applicable, verify the resource provenance and authenticity</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 904.8545008917187 1713.990054564 L 965.1690976917187 1713.990054564 L 965.1690976917187 1733.592298524 L 917.2692553997186 1733.592298524" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(904.8545008917187,1733.592298524) translate(-904.8545008917187,-1733.592298524)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 917.4200418917187 1727.309528024 L 904.8545008917187 1733.592298524 L 917.4200418917187 1739.875069024 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 15.078649199999973 868.077834444 L 637.2775405740624 868.077834444 L 637.2775405740624 1011.325001844 L 15.078649199999973 1011.325001844 L 15.078649199999973 868.077834444 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 15.078649199999973 868.077834444 L 15.078649199999973 886.172213484 L 217.3692788988281 886.172213484 L 226.4164684188281 877.125023964 L 226.4164684188281 868.077834444 L 15.078649199999973 868.077834444" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="30.157298399999974" y="880.140753804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1540.341174098828 1281.2328225239999 L 2238.3400532658593 1281.2328225239999 L 2238.3400532658593 1514.951885124 L 1540.341174098828 1514.951885124 L 1540.341174098828 1281.2328225239999 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1540.341174098828 1281.2328225239999 L 1540.341174098828 1299.3272015639998 L 1742.6318037976562 1299.3272015639998 L 1751.6789933176562 1290.280012044 L 1751.6789933176562 1281.2328225239999 L 1540.341174098828 1281.2328225239999" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1555.419823298828" y="1293.2957418839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment</text></g></g></g></svg>