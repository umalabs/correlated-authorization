<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2201" height="1717"><desc>participant%20%22AuthZ%20Server%20%E2%80%93%20Requesting%20Party%20(AS-RqP)%22%20as%20AS-RqP%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22AuthZ%20Server%20%E2%80%93%20Resource%20Owner%20(AS-RO)%22%20as%20AS-RO%0A%0Abottomparticipants%0A%0Anote%20over%20AS-RqP%3AAS-RqP%3A%5Cn%E2%80%A2%20supports%20the%20token%20exchange%20extension%20of%20OAuth2%5Cn%E2%80%A2%20publishes%20its%20metadata%20on%20a%20URL%20%2F.well-known%2Foauth-authorization-server%5Cn%E2%80%A2%20also%20acts%20as%20RqP's%20Identity%20Provider%0Anote%20over%20Client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20AS-RqP%20as%20a%20public%20or%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20Relying%20Party%20in%20a%20RqP's%20Identity%20Provider%20in%20order%20to%20obtain%20an%20an%20access_token_with_user_claims%5Cn%E2%80%A2%20should%20be%20registered%20at%20AS-RO%20as%20a%20public%20or%20confidential%20client%3B%20in%20case%20of%20immediate%20access%2C%5Cn%20%20%20the%20client%20does%20not%20have%20to%20be%20registered%20at%20AS-RO%0Anote%20over%20RS%3ARO%20has%20set%20up%20RS%20and%20registers%20its%20'RS%20API'%20resource%20at%20AS-RO%0ARS%3C-Client%3A1.%20Request%20'RS%20API'%20resource%20with%20no%20access%20token%0ARS-%3EAS-RO%3A2.%20Request%20a%20permission%20ticket%0Anote%20over%20AS-RO%3A%20AS-RO%20generates%20a%20permission%20ticket%20itself%20and%20the%20bound%20permission%20token%5Cn(bound%20to%20the%20permission%20ticket%20via%20token%20hash)%2C%20which%20contains%20these%20claims%3A%5Cn%7Bissuer%2C%20ts%2C%20ticket_hash%2C%20rs_uri%7D%5Cnwhere%5Cnticket%20is%20a%20random%20NONCE%5Cnissuer%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20permission%20token%5Cnts%20is%20the%20timestamp%20of%20when%20the%20permission%20ticket%20was%20created%5Cnticket_hash%20%3D%20Base64URL-Encode(SHA256(ticket))%5Cnrs_uri%20is%20the%20URI%20that%20identifies%20the%20resource%20server%0ARS%3C-AS-RO%3A3.%20Return%20the%20permission%20ticket%20and%20the%20permission%20token%0ARS-%3EClient%3A4.%20Return%20401%20with%20the%20permission%20ticket%20and%20the%20permission%20token%0AAS-RqP%3C-Client%3A5.%20Request%20a%20claims%20token%20(token%20exchange%20request)%5Cn%20%20%20%20%7Bgrant_type%20%3D%20token-exchange%2C%5Cn%20%20%20%20%20resource%20%3D%20%22RS%20API%22%2C%5Cn%20%20%20%20%20scope%20%3D%20permission_token%2C%5Cn%20%20%20%20%20subject_token%20%3D%20access_token_with_user_claims%2C%5Cn%20%20%20%20%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%2C%5Cn%20%20%20%20%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%7D%0Agroup%20Authorization%20assessment%0Anote%20over%20AS-RqP%3A1.%20verify%20permission_token%5Cn2.%20evaluate%20issuer%2C%20ts%20and%20rs_uri%0Aend%0Anote%20over%20AS-RqP%3AAS-RqP%20generates%20a%20claim%20token%2C%20which%20contains%20these%20claims%3A%5Cn%7Buser_claims%2C%20ticket_hash%7D%5Cnwhere%5Cnuser_claims%20are%20extracted%20from%20access_token_with_user_claims%5Cnticket_hash%20is%20extracted%20from%20permission_token%0AClient%3C-AS-RqP%3A6.%20Return%20claims%20token%5Cn%20%20%20%20%7Bclaims_token%7D%0A%0AClient-%3EAS-RO%3A7.%20Request%20a%20Requesting%20Party%20Token%20(RPT)%5Cn%20%20%20%20%7Bgrant_type%20%3D%20uma-ticket%2C%5Cn%20%20%20%20%20pushed_claims%20%3D%20claims_token%7D%0Agroup%20Authorization%20assessment%0Anote%20over%20AS-RO%3A1.%20verify%20ticket%5Cn2.%20extract%20user_claims%20from%20claims_token%5Cn3.%20select%20email_address%20claim%5Cn4.%20bootstrap%20discovery%20of%20AS-RqP%20config%20url%20from%20email%20address%20via%20WebFinger%3B%5Cn%20%20%20%20if%20this%20doesn't%20work%2C%20build%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20evaluate%20resource%20%3D%20%22RS%20API%22%5Cn7.%20extract%20ticket_hash%20scope%20from%20claims_token%5Cn8.%20compare%20ticket_hash%20vs.%20Base64URL-Encode(SHA256(ticket))%5Cn9.%20evaluate%20user_claims%0Aend%0AClient%3C-AS-RO%3A8.%20Return%20RPT%5Cn%20%20%20%20%7BRPT%7D%0ARS%3C-Client%3A9.%20Get%20data%20from%20'RS%20API'%20resource%5Cn%20%20%20%20%7BRPT%7D%0ARS-%3EClient%3A10.%20Return%20protected%20resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2201" height="1717"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 303.5327647788281 50.815047804 L 303.5327647788281 1664.230512204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 882.2091707835156 50.815047804 L 882.2091707835156 1664.230512204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1408.6855645811718 50.815047804 L 1408.6855645811718 1664.230512204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1866.6952835741404 50.815047804 L 1866.6952835741404 1664.230512204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 133.35576474741404 10.253481456000003 L 473.7097648102422 10.253481456000003 L 473.7097648102422 50.815047804 L 133.35576474741404 50.815047804 L 133.35576474741404 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="149.71609912941403" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 844.5988364015155 10.253481456000003 L 919.8195051655156 10.253481456000003 L 919.8195051655156 50.815047804 L 844.5988364015155 50.815047804 L 844.5988364015155 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="860.9591707835156" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1314.4585614979999 10.253481456000003 L 1502.9125676643437 10.253481456000003 L 1502.9125676643437 50.815047804 L 1314.4585614979999 50.815047804 L 1314.4585614979999 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1330.81889588" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1702.184955295656 10.253481456000003 L 2031.2056118526248 10.253481456000003 L 2031.2056118526248 50.815047804 L 1702.184955295656 50.815047804 L 1702.184955295656 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1718.545289677656" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 133.35576474741404 1664.230512204 L 473.7097648102422 1664.230512204 L 473.7097648102422 1704.792078552 L 133.35576474741404 1704.792078552 L 133.35576474741404 1664.230512204 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="149.71609912941403" y="1689.713429352" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 844.5988364015155 1664.230512204 L 919.8195051655156 1664.230512204 L 919.8195051655156 1704.792078552 L 844.5988364015155 1704.792078552 L 844.5988364015155 1664.230512204 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="860.9591707835156" y="1689.713429352" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1314.4585614979999 1664.230512204 L 1502.9125676643437 1664.230512204 L 1502.9125676643437 1704.792078552 L 1314.4585614979999 1704.792078552 L 1314.4585614979999 1664.230512204 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1330.81889588" y="1689.713429352" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1702.184955295656 1664.230512204 L 2031.2056118526248 1664.230512204 L 2031.2056118526248 1704.792078552 L 1702.184955295656 1704.792078552 L 1702.184955295656 1664.230512204 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1718.545289677656" y="1689.713429352" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 80.972346204 L 585.9554206776562 80.972346204 L 599.5262049576562 94.543130484 L 599.5262049576562 160.889186964 L 7.5393246000000005 160.889186964 L 7.5393246000000005 80.972346204 M 585.9554206776562 80.972346204 L 585.9554206776562 94.543130484 L 599.5262049576562 94.543130484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="102.082455084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="117.161104284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the token exchange extension of OAuth2</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• publishes its metadata on a URL /.well-known/oauth-authorization-server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="147.318402684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• also acts as RqP's Identity Provider</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 463.5073870988281 183.507160764 L 1287.340170188203 183.507160764 L 1300.910954468203 197.077945044 L 1300.910954468203 278.502650724 L 463.5073870988281 278.502650724 L 463.5073870988281 183.507160764 M 1287.340170188203 183.507160764 L 1287.340170188203 197.077945044 L 1300.910954468203 197.077945044" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.61749597882806" y="204.61726964399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.61749597882806" y="219.69591884399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at AS-RqP as a public or confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.61749597882806" y="234.77456804399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a Relying Party in a RqP's Identity Provider in order to obtain an an access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.61749597882806" y="249.85321724399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should be registered at AS-RO as a public or confidential client; in case of immediate access,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.61749597882806" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the client does not have to be registered at AS-RO</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1163.0587931035157 301.120624524 L 1640.7415517788281 301.120624524 L 1654.3123360588281 314.691408804 L 1654.3123360588281 335.801517684 L 1163.0587931035157 335.801517684 L 1163.0587931035157 301.120624524 M 1640.7415517788281 301.120624524 L 1640.7415517788281 314.691408804 L 1654.3123360588281 314.691408804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1184.1689019835155" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RO has set up RS and registers its 'RS API' resource at AS-RO</text></g><g><g><rect fill="white" stroke="none" x="960.6105733541015" y="358.419491484" width="369.67358865648436" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="962.8723707341014" y="371.990275764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request 'RS API' resource with no access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 882.2091707835156 378.021735444 L 1396.2708100731718 378.021735444" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1408.6855645811718,378.021735444) translate(-1408.6855645811718,-378.021735444)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1396.1200235811718 371.738964944 L 1408.6855645811718 378.021735444 L 1396.1200235811718 384.304505944 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1524.386962574121" y="400.639709244" width="226.60692300707032" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1526.648759954121" y="414.21049352400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Request a permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1408.6855645811718 420.241953204 L 1854.2805290661404 420.241953204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1866.6952835741404,420.241953204) translate(-1866.6952835741404,-420.241953204)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1854.1297425741404 413.959182704 L 1866.6952835741404 420.241953204 L 1854.1297425741404 426.52472370400005 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1561.0601807976561 442.85992700400004 L 2158.7596020706246 442.85992700400004 L 2172.330386350625 456.43071128400004 L 2172.330386350625 598.170013764 L 1561.0601807976561 598.170013764 L 1561.0601807976561 442.85992700400004 M 2158.7596020706246 442.85992700400004 L 2158.7596020706246 456.43071128400004 L 2172.330386350625 456.43071128400004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="463.970035884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RO generates a permission ticket itself and the bound permission token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="479.048685084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(bound to the permission ticket via token hash), which contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="494.12733428399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{issuer, ts, ticket_hash, rs_uri}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="509.20598348399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="524.2846326839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket is a random NONCE</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="539.3632818839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">issuer is the URI that identifies who issues the permission token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="554.4419310839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ts is the timestamp of when the permission ticket was created</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="569.5205802839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_hash = Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1582.170289677656" y="584.5992294839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">rs_uri is the URI that identifies the resource server</text></g><g><g><rect fill="white" stroke="none" x="1426.5286328011719" y="620.787987564" width="422.32358255296873" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1428.7904301811718" y="634.358771844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Return the permission ticket and the permission token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1866.6952835741404 640.390231524 L 1421.1003190891718 640.390231524" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1408.6855645811718,640.390231524) translate(-1408.6855645811718,-640.390231524)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1421.2511055811717 634.107461024 L 1408.6855645811718 640.390231524 L 1421.2511055811717 646.673002024 Z"/></g></g><g><g><rect fill="white" stroke="none" x="900.0522390035155" y="663.008205324" width="490.79025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="902.3140363835155" y="676.578989604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return 401 with the permission ticket and the permission token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1408.6855645811718 682.610449284 L 894.6239252915155 682.610449284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(882.2091707835156,682.610449284) translate(-882.2091707835156,-682.610449284)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 894.7747117835156 676.327678784 L 882.2091707835156 682.610449284 L 894.7747117835156 688.8932197839999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="321.3758329988281" y="705.228423084" width="387.4402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="321.3758329988281" y="720.307072284" width="255.84026040941407" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="321.3758329988281" y="735.385721484" width="178.55693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="321.3758329988281" y="750.464370684" width="225.74025430589845" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="321.3758329988281" y="765.5430198839999" width="385.85693826585936" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="321.3758329988281" y="780.6216690839999" width="542.9902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="321.3758329988281" y="795.7003182839999" width="492.6236008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="323.63763037882813" y="718.799207364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Request a claims token (token exchange request)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="323.63763037882813" y="733.877856564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = token-exchange,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="323.63763037882813" y="748.956505764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     resource = "RS API",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="323.63763037882813" y="764.035154964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     scope = permission_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="323.63763037882813" y="779.1138041639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token = access_token_with_user_claims,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="323.63763037882813" y="794.1924533639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token_type = urn:ietf:params:oauth:token-type:access_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="323.63763037882813" y="809.2711025639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     requested_token_type = urn:ietf:params:oauth:token-type:jwt}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 882.2091707835156 815.302562244 L 315.9475192868281 815.302562244" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(303.5327647788281,815.302562244) translate(-303.5327647788281,-815.302562244)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 316.0983057788281 809.019791744 L 303.5327647788281 815.302562244 L 316.0983057788281 821.585332744 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 166.90598567177727 878.6328888840001 L 426.5887596058789 878.6328888840001 L 440.1595438858789 892.2036731640001 L 440.1595438858789 928.392431244 L 166.90598567177727 928.392431244 L 166.90598567177727 878.6328888840001 M 426.5887596058789 878.6328888840001 L 426.5887596058789 892.2036731640001 L 440.1595438858789 892.2036731640001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="188.01609455177731" y="899.7429977639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify permission_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="188.01609455177731" y="914.8216469639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. evaluate issuer, ts and rs_uri</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 50.62265284707031 973.628378844 L 542.8720924305859 973.628378844 L 556.4428767105859 987.199163124 L 556.4428767105859 1068.623868804 L 50.62265284707031 1068.623868804 L 50.62265284707031 973.628378844 M 542.8720924305859 973.628378844 L 542.8720924305859 987.199163124 L 556.4428767105859 987.199163124" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="71.73276172707028" y="994.738487724" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP generates a claim token, which contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="71.73276172707028" y="1009.817136924" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{user_claims, ticket_hash}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="71.73276172707028" y="1024.895786124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="71.73276172707028" y="1039.974435324" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">user_claims are extracted from access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="71.73276172707028" y="1055.053084524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ticket_hash is extracted from permission_token</text></g><g><g><rect fill="white" stroke="none" x="508.1675047517578" y="1091.2418426039999" width="169.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="508.1675047517578" y="1106.3204918039999" width="137.39026346117188" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="510.4293021317578" y="1104.8126268839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Return claims token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="510.4293021317578" y="1119.8912760839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {claims_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 303.5327647788281 1125.922735764 L 869.7944162755156 1125.922735764" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(882.2091707835156,1125.922735764) translate(-882.2091707835156,-1125.922735764)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 869.6436297835155 1119.639965264 L 882.2091707835156 1125.922735764 L 869.6436297835155 1132.205506264 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1216.315429798828" y="1148.5407095639998" width="316.27359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1216.315429798828" y="1163.6193587639998" width="216.85692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1216.315429798828" y="1178.6980079639998" width="262.77359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1218.577227178828" y="1162.1114938439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Request a Requesting Party Token (RPT)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1218.577227178828" y="1177.1901430439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = uma-ticket,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1218.577227178828" y="1192.2687922439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     pushed_claims = claims_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 882.2091707835156 1198.300251924 L 1854.2805290661404 1198.300251924" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1866.6952835741404,1198.300251924) translate(-1866.6952835741404,-1198.300251924)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1854.1297425741404 1192.017481424 L 1866.6952835741404 1198.300251924 L 1854.1297425741404 1204.5830224239999 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1554.2268372917968 1261.630578564 L 2165.592945576484 1261.630578564 L 2179.163729856484 1275.201362844 L 2179.163729856484 1432.019314524 L 1554.2268372917968 1432.019314524 L 1554.2268372917968 1261.630578564 M 2165.592945576484 1261.630578564 L 2165.592945576484 1275.201362844 L 2179.163729856484 1275.201362844" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1282.740687444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1297.819336644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1312.897985844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1327.976635044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. bootstrap discovery of AS-RqP config url from email address via WebFinger;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1343.055284244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    if this doesn't work, build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1358.133933444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1373.212582644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. evaluate resource = "RS API"</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1388.2912318439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract ticket_hash scope from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1403.3698810439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. compare ticket_hash vs. Base64URL-Encode(SHA256(ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1575.3369461717966" y="1418.4485302439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate user_claims</text></g><g><g><rect fill="white" stroke="none" x="1322.1737633864745" y="1477.255262124" width="104.55692758470703" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1322.1737633864745" y="1492.333911324" width="69.87359323412109" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1324.4355607664745" y="1490.826046404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return RPT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1324.4355607664745" y="1505.904695604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {RPT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1866.6952835741404 1511.936155284 L 894.6239252915155 1511.936155284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(882.2091707835156,1511.936155284) translate(-882.2091707835156,-1511.936155284)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 894.7747117835156 1505.653384784 L 882.2091707835156 1511.936155284 L 894.7747117835156 1518.218925784 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1018.3605733541015" y="1534.554129084" width="254.17358865648438" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1018.3605733541015" y="1549.6327782839999" width="69.87359323412109" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1020.6223707341014" y="1548.124913364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Get data from 'RS API' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1020.6223707341014" y="1563.2035625639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {RPT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 882.2091707835156 1569.235022244 L 1396.2708100731718 1569.235022244" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1408.6855645811718,1569.235022244) translate(-1408.6855645811718,-1569.235022244)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1396.1200235811718 1562.952251744 L 1408.6855645811718 1569.235022244 L 1396.1200235811718 1575.517792744 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1032.9439016011718" y="1591.852996044" width="225.00693216234376" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1035.2056989811717" y="1605.423780324" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1408.6855645811718 1611.455240004 L 894.6239252915155 1611.455240004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(882.2091707835156,1611.455240004) translate(-882.2091707835156,-1611.455240004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 894.7747117835156 1605.172469504 L 882.2091707835156 1611.455240004 L 894.7747117835156 1617.738010504 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 159.3666610717773 837.920536044 L 447.6988684858789 837.920536044 L 447.6988684858789 951.010405044 L 159.3666610717773 951.010405044 L 159.3666610717773 837.920536044 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 159.3666610717773 837.920536044 L 159.3666610717773 856.014915084 L 361.6572907706054 856.014915084 L 370.70448029060543 846.9677255639999 L 370.70448029060543 837.920536044 L 159.3666610717773 837.920536044" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="174.4453102717773" y="849.983455404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1546.6875126917967 1220.918225724 L 2186.703054456484 1220.918225724 L 2186.703054456484 1454.637288324 L 1546.6875126917967 1454.637288324 L 1546.6875126917967 1220.918225724 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1546.6875126917967 1220.918225724 L 1546.6875126917967 1239.012604764 L 1748.9781423906247 1239.012604764 L 1758.0253319106248 1229.965415244 L 1758.0253319106248 1220.918225724 L 1546.6875126917967 1220.918225724" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1561.7661618917966" y="1232.981145084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment</text></g></g></g></svg>