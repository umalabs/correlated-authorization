<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2303" height="1747"><desc>participant%20%22AuthZ%20Server%20%E2%80%93%20Requesting%20Party%20(AS-RqP)%22%20as%20AS-RqP%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22AuthZ%20Server%20%E2%80%93%20Resource%20Owner%20(AS-RO)%22%20as%20AS-RO%0A%0Abottomparticipants%0A%0Anote%20over%20AS-RqP%3AAS-RqP%3A%5Cn%E2%80%A2%20supports%20the%20token%20exchange%20extension%20of%20OAuth2%5Cn%E2%80%A2%20publishes%20its%20metadata%20on%20a%20URL%20%2F.well-known%2Foauth-authorization-server%5Cn%E2%80%A2%20also%20acts%20as%20RqP's%20Identity%20Provider%0Anote%20over%20Client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20AS-RqP%20as%20a%20public%20or%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20Relying%20Party%20in%20a%20RqP's%20Identity%20Provider%20in%20order%20to%20obtain%20an%20an%20access_token_with_user_claims%5Cn%E2%80%A2%20should%20be%20registered%20at%20AS-RO%20as%20a%20public%20or%20confidential%20client%3B%20in%20case%20of%20immediate%20access%2C%5Cn%20%20%20the%20client%20does%20not%20have%20to%20be%20registered%20at%20AS-RO%0Anote%20over%20RS%3ARO%20has%20set%20up%20RS%20and%20registers%20his%20'RS%20API'%20resource%20at%20AS-RO%0ARS%3C-Client%3A1.%20Request%20'RS%20API'%20resource%20with%20no%20access%20token%0ARS-%3EAS-RO%3A2.%20Request%20a%20permission%20ticket%0Anote%20over%20AS-RO%3A%20AS-RO%20generates%20the%20permission%20ticket%20itself%20(ticket%20is%20a%20random%20NONCE)%20and%20the%20permission%20token%2C%5Cnwhich%20is%20bound%20to%20the%20permission%20ticket%20through%20a%20permission%20ticket%20hash.%5CnThe%20permission%20token%20contains%20these%20claims%3A%5Cn%7Bissuer%2C%20ts%2C%20rs_uri%2C%20resource_name_hash%2C%20permission_ticket_hash%7D%5Cnwhere%5Cnissuer%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20permission%20token%5Cnts%20is%20the%20timestamp%20of%20when%20the%20permission%20ticket%20was%20created%5Cnrs_uri%20is%20the%20URI%20that%20identifies%20the%20resource%20server%5Cnresource_name_hash%20%3D%20Base64URL-Encode(SHA256(resource_name))%5Cnpermission_ticket_hash%20%3D%20Base64URL-Encode(SHA256(permission_ticket))%0ARS%3C-AS-RO%3A3.%20Return%20the%20permission%20ticket%20and%20the%20permission%20token%0ARS-%3EClient%3A4.%20Return%20401%20with%20the%20permission%20ticket%20and%20the%20permission%20token%0AAS-RqP%3C-Client%3A5.%20Request%20a%20claims%20token%20(token%20exchange%20request)%5Cn%20%20%20%20%7Bgrant_type%20%3D%20token-exchange%2C%5Cn%20%20%20%20%20resource%20%3D%20%22RS%20API%22%2C%5Cn%20%20%20%20%20scope%20%3D%20permission_token%20resource_name%2C%5Cn%20%20%20%20%20subject_token%20%3D%20access_token_with_user_claims%2C%5Cn%20%20%20%20%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%2C%5Cn%20%20%20%20%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%7D%0Agroup%20Authorization%20assessment%0Anote%20over%20AS-RqP%3A1.%20verify%20permission_token%5Cn2.%20compare%20resource_name_hash%20vs.%20Base64URL-Encode(SHA256(resource_name))%5Cn3.%20evaluate%20issuer%2C%20ts%2C%20rs_uri%2C%20resource_name%0Aend%0Anote%20over%20AS-RqP%3AAS-RqP%20generates%20the%20claim%20token%2C%20which%20contains%20these%20claims%3A%5Cn%7Buser_claims%2C%20permission_ticket_hash%7D%5Cnwhere%5Cnuser_claims%20are%20extracted%20from%20access_token_with_user_claims%5Cnpermission_ticket_hash%20is%20extracted%20from%20permission_token%0AClient%3C-AS-RqP%3A6.%20Return%20claims%20token%5Cn%20%20%20%20%7Bclaims_token%7D%0A%0AClient-%3EAS-RO%3A7.%20Request%20a%20Requesting%20Party%20Token%20(RPT)%5Cn%20%20%20%20%7Bgrant_type%20%3D%20uma-ticket%2C%5Cn%20%20%20%20%20pushed_claims%20%3D%20claims_token%7D%0Agroup%20Authorization%20assessment%0Anote%20over%20AS-RO%3A1.%20verify%20permission_ticket%5Cn2.%20extract%20user_claims%20from%20claims_token%5Cn3.%20select%20email_address%20claim%5Cn4.%20bootstrap%20discovery%20of%20AS-RqP%20config%20url%20from%20email%20address%20via%20WebFinger%3B%5Cn%20%20%20%20if%20this%20doesn't%20work%2C%20build%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20evaluate%20resource%20%3D%20%22RS%20API%22%5Cn7.%20extract%20permission_ticket_hash%20scope%20from%20claims_token%5Cn8.%20compare%20permission_ticket_hash%20vs.%20Base64URL-Encode(SHA256(permission_ticket))%5Cn9.%20evaluate%20user_claims%0Aend%0AClient%3C-AS-RO%3A8.%20Return%20RPT%5Cn%20%20%20%20%7BRPT%7D%0ARS%3C-Client%3A9.%20Get%20data%20from%20'RS%20API'%20resource%5Cn%20%20%20%20%7BRPT%7D%0ARS-%3EClient%3A10.%20Return%20protected%20resource</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2303" height="1747"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 348.3780765764843 50.815047804 L 348.3780765764843 1694.387810604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 927.0544825811718 50.815047804 L 927.0544825811718 1694.387810604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1453.530876378828 50.815047804 L 1453.530876378828 1694.387810604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1911.5405953717968 50.815047804 L 1911.5405953717968 1694.387810604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 178.20107654507026 10.253481456000003 L 518.5550766078984 10.253481456000003 L 518.5550766078984 50.815047804 L 178.20107654507026 50.815047804 L 178.20107654507026 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="194.56141092707026" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 889.4441481991718 10.253481456000003 L 964.6648169631718 10.253481456000003 L 964.6648169631718 50.815047804 L 889.4441481991718 50.815047804 L 889.4441481991718 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="905.8044825811718" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1359.303873295656 10.253481456000003 L 1547.757879462 10.253481456000003 L 1547.757879462 50.815047804 L 1359.303873295656 50.815047804 L 1359.303873295656 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1375.6642076776561" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1747.0302670933124 10.253481456000003 L 2076.050923650281 10.253481456000003 L 2076.050923650281 50.815047804 L 1747.0302670933124 50.815047804 L 1747.0302670933124 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1763.3906014753125" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 178.20107654507026 1694.387810604 L 518.5550766078984 1694.387810604 L 518.5550766078984 1734.949376952 L 178.20107654507026 1734.949376952 L 178.20107654507026 1694.387810604 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="194.56141092707026" y="1719.870727752" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 889.4441481991718 1694.387810604 L 964.6648169631718 1694.387810604 L 964.6648169631718 1734.949376952 L 889.4441481991718 1734.949376952 L 889.4441481991718 1694.387810604 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="905.8044825811718" y="1719.870727752" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1359.303873295656 1694.387810604 L 1547.757879462 1694.387810604 L 1547.757879462 1734.949376952 L 1359.303873295656 1734.949376952 L 1359.303873295656 1694.387810604 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1375.6642076776561" y="1719.870727752" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1747.0302670933124 1694.387810604 L 2076.050923650281 1694.387810604 L 2076.050923650281 1734.949376952 L 1747.0302670933124 1734.949376952 L 1747.0302670933124 1694.387810604 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1763.3906014753125" y="1719.870727752" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 52.38463639765622 80.972346204 L 630.8007324753124 80.972346204 L 644.3715167553124 94.543130484 L 644.3715167553124 160.889186964 L 52.38463639765622 160.889186964 L 52.38463639765622 80.972346204 M 630.8007324753124 80.972346204 L 630.8007324753124 94.543130484 L 644.3715167553124 94.543130484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.4947452776562" y="102.082455084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.4947452776562" y="117.161104284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the token exchange extension of OAuth2</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.4947452776562" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• publishes its metadata on a URL /.well-known/oauth-authorization-server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="73.4947452776562" y="147.318402684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• also acts as RqP's Identity Provider</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 508.3526988964843 183.507160764 L 1332.1854819858593 183.507160764 L 1345.7562662658593 197.077945044 L 1345.7562662658593 278.502650724 L 508.3526988964843 278.502650724 L 508.3526988964843 183.507160764 M 1332.1854819858593 183.507160764 L 1332.1854819858593 197.077945044 L 1345.7562662658593 197.077945044" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="529.4628077764843" y="204.61726964399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="529.4628077764843" y="219.69591884399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at AS-RqP as a public or confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="529.4628077764843" y="234.77456804399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a Relying Party in a RqP's Identity Provider in order to obtain an an access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="529.4628077764843" y="249.85321724399998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• should be registered at AS-RO as a public or confidential client; in case of immediate access,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="529.4628077764843" y="264.931866444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   the client does not have to be registered at AS-RO</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1206.1290957458984 301.120624524 L 1687.3618727317578 301.120624524 L 1700.9326570117578 314.691408804 L 1700.9326570117578 335.801517684 L 1206.1290957458984 335.801517684 L 1206.1290957458984 301.120624524 M 1687.3618727317578 301.120624524 L 1687.3618727317578 314.691408804 L 1700.9326570117578 314.691408804" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1227.2392046258983" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RO has set up RS and registers his 'RS API' resource at AS-RO</text></g><g><g><rect fill="white" stroke="none" x="1005.4558851517577" y="358.419491484" width="369.67358865648436" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1007.7176825317576" y="371.990275764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Request 'RS API' resource with no access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 927.0544825811718 378.021735444 L 1441.116121870828 378.021735444" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1453.530876378828,378.021735444) translate(-1453.530876378828,-378.021735444)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1440.965335378828 371.738964944 L 1453.530876378828 378.021735444 L 1440.965335378828 384.304505944 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1569.2322743717773" y="400.639709244" width="226.60692300707032" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1571.4940717517773" y="414.21049352400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Request a permission ticket</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1453.530876378828 420.241953204 L 1899.1258408637968 420.241953204" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1911.5405953717968,420.241953204) translate(-1911.5405953717968,-420.241953204)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1898.975054371797 413.959182704 L 1911.5405953717968 420.241953204 L 1898.975054371797 426.52472370400005 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1527.0138299976563 442.859927004 L 2282.4965764659373 442.859927004 L 2296.0673607459375 456.430711284 L 2296.0673607459375 613.248662964 L 1527.0138299976563 613.248662964 L 1527.0138299976563 442.859927004 M 2282.4965764659373 442.859927004 L 2282.4965764659373 456.430711284 L 2296.0673607459375 456.430711284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="463.970035884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RO generates the permission ticket itself (ticket is a random NONCE) and the permission token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="479.048685084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">which is bound to the permission ticket through a permission ticket hash.</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="494.12733428399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The permission token contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="509.20598348399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{issuer, ts, rs_uri, resource_name_hash, permission_ticket_hash}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="524.2846326839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="539.3632818839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">issuer is the URI that identifies who issues the permission token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="554.4419310839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ts is the timestamp of when the permission ticket was created</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="569.5205802839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">rs_uri is the URI that identifies the resource server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="584.5992294839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">resource_name_hash = Base64URL-Encode(SHA256(resource_name))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1548.1239388776562" y="599.6778786839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">permission_ticket_hash = Base64URL-Encode(SHA256(permission_ticket))</text></g><g><g><rect fill="white" stroke="none" x="1471.373944598828" y="635.866636764" width="422.32358255296873" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1473.635741978828" y="649.437421044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Return the permission ticket and the permission token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1911.5405953717968 655.468880724 L 1465.945630886828 655.468880724" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1453.530876378828,655.468880724) translate(-1453.530876378828,-655.468880724)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1466.096417378828 649.186110224 L 1453.530876378828 655.468880724 L 1466.096417378828 661.7516512239999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="944.8975508011717" y="678.0868545239999" width="490.79025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="947.1593481811717" y="691.6576388039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return 401 with the permission ticket and the permission token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1453.530876378828 697.6890984839999 L 939.4692370891718 697.6890984839999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(927.0544825811718,697.6890984839999) translate(-927.0544825811718,-697.6890984839999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 939.6200235811718 691.406327984 L 927.0544825811718 697.6890984839999 L 939.6200235811718 703.9718689839999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="366.22114479648434" y="720.307072284" width="387.4402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="366.22114479648434" y="735.385721484" width="255.84026040941407" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="366.22114479648434" y="750.464370684" width="178.55693521410157" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="366.22114479648434" y="765.5430198839999" width="342.85693826585936" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="366.22114479648434" y="780.6216690839999" width="385.85693826585936" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="366.22114479648434" y="795.7003182839999" width="542.9902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="366.22114479648434" y="810.7789674839998" width="492.6236008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.48294217648436" y="733.877856564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Request a claims token (token exchange request)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.48294217648436" y="748.956505764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = token-exchange,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.48294217648436" y="764.035154964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     resource = "RS API",</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.48294217648436" y="779.1138041639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     scope = permission_token resource_name,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.48294217648436" y="794.1924533639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token = access_token_with_user_claims,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.48294217648436" y="809.2711025639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token_type = urn:ietf:params:oauth:token-type:access_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="368.48294217648436" y="824.3497517639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     requested_token_type = urn:ietf:params:oauth:token-type:jwt}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 927.0544825811718 830.381211444 L 360.7928310844843 830.381211444" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(348.3780765764843,830.381211444) translate(-348.3780765764843,-830.381211444)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 360.9436175764843 824.098440944 L 348.3780765764843 830.381211444 L 360.9436175764843 836.6639819439999 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 22.617973799999973 893.7115380839999 L 660.5673950729687 893.7115380839999 L 674.1381793529687 907.2823223639999 L 674.1381793529687 958.549729644 L 22.617973799999973 958.549729644 L 22.617973799999973 893.7115380839999 M 660.5673950729687 893.7115380839999 L 660.5673950729687 907.2823223639999 L 674.1381793529687 907.2823223639999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="914.8216469639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify permission_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="929.9002961639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. compare resource_name_hash vs. Base64URL-Encode(SHA256(resource_name))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="944.9789453639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. evaluate issuer, ts, rs_uri, resource_name</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 91.5013050988281 1003.785677244 L 591.6840637741406 1003.785677244 L 605.2548480541406 1017.356461524 L 605.2548480541406 1098.781167204 L 91.5013050988281 1098.781167204 L 91.5013050988281 1003.785677244 M 591.6840637741406 1003.785677244 L 591.6840637741406 1017.356461524 L 605.2548480541406 1017.356461524" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="112.61141397882807" y="1024.8957861239999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP generates the claim token, which contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="112.61141397882807" y="1039.9744353239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{user_claims, permission_ticket_hash}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="112.61141397882807" y="1055.0530845239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="112.61141397882807" y="1070.1317337239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">user_claims are extracted from access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="112.61141397882807" y="1085.2103829239998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">permission_ticket_hash is extracted from permission_token</text></g><g><g><rect fill="white" stroke="none" x="553.0128165494141" y="1121.3991410039998" width="169.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="553.0128165494141" y="1136.4777902039998" width="137.39026346117188" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="555.274613929414" y="1134.9699252839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Return claims token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="555.274613929414" y="1150.0485744839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {claims_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 348.3780765764843 1156.080034164 L 914.6397280731718 1156.080034164" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(927.0544825811718,1156.080034164) translate(-927.0544825811718,-1156.080034164)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 914.4889415811717 1149.797263664 L 927.0544825811718 1156.080034164 L 914.4889415811717 1162.362804664 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1261.1607415964843" y="1178.6980079639998" width="316.27359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1261.1607415964843" y="1193.7766571639997" width="216.85692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1261.1607415964843" y="1208.8553063639997" width="262.77359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1263.4225389764842" y="1192.2687922439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Request a Requesting Party Token (RPT)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1263.4225389764842" y="1207.3474414439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = uma-ticket,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1263.4225389764842" y="1222.4260906439997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     pushed_claims = claims_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 927.0544825811718 1228.4575503239998 L 1899.1258408637968 1228.4575503239998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1911.5405953717968,1228.4575503239998) translate(-1911.5405953717968,-1228.4575503239998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1898.975054371797 1222.1747798239999 L 1911.5405953717968 1228.4575503239998 L 1898.975054371797 1234.7403208239998 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1570.0804803882813 1291.787876964 L 2239.4299260753123 1291.787876964 L 2253.0007103553125 1305.358661244 L 2253.0007103553125 1462.176612924 L 1570.0804803882813 1462.176612924 L 1570.0804803882813 1291.787876964 M 2239.4299260753123 1291.787876964 L 2239.4299260753123 1305.358661244 L 2253.0007103553125 1305.358661244" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1312.897985844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify permission_ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1327.976635044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1343.055284244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1358.133933444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. bootstrap discovery of AS-RqP config url from email address via WebFinger;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1373.212582644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    if this doesn't work, build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1388.2912318439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1403.3698810439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. evaluate resource = "RS API"</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1418.4485302439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract permission_ticket_hash scope from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1433.5271794439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. compare permission_ticket_hash vs. Base64URL-Encode(SHA256(permission_ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1591.1905892682812" y="1448.6058286439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate user_claims</text></g><g><g><rect fill="white" stroke="none" x="1367.0190751841308" y="1507.412560524" width="104.55692758470703" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1367.0190751841308" y="1522.4912097239999" width="69.87359323412109" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1369.2808725641307" y="1520.983344804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return RPT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1369.2808725641307" y="1536.0619940039999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {RPT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1911.5405953717968 1542.093453684 L 939.4692370891718 1542.093453684" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(927.0544825811718,1542.093453684) translate(-927.0544825811718,-1542.093453684)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 939.6200235811718 1535.810683184 L 927.0544825811718 1542.093453684 L 939.6200235811718 1548.376224184 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1063.2058851517577" y="1564.7114274839998" width="254.17358865648438" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1063.2058851517577" y="1579.7900766839998" width="69.87359323412109" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1065.4676825317576" y="1578.2822117639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Get data from 'RS API' resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1065.4676825317576" y="1593.3608609639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {RPT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 927.0544825811718 1599.392320644 L 1441.116121870828 1599.392320644" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1453.530876378828,1599.392320644) translate(-1453.530876378828,-1599.392320644)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1440.965335378828 1593.109550144 L 1453.530876378828 1599.392320644 L 1440.965335378828 1605.675091144 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1077.789213398828" y="1622.010294444" width="225.00693216234376" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1080.051010778828" y="1635.581078724" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return protected resource</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1453.530876378828 1641.612538404 L 939.4692370891718 1641.612538404" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(927.0544825811718,1641.612538404) translate(-927.0544825811718,-1641.612538404)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 939.6200235811718 1635.329767904 L 927.0544825811718 1641.612538404 L 939.6200235811718 1647.8953089039999 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 15.078649199999973 852.9991852439999 L 681.6775039529687 852.9991852439999 L 681.6775039529687 981.1677034439999 L 15.078649199999973 981.1677034439999 L 15.078649199999973 852.9991852439999 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 15.078649199999973 852.9991852439999 L 15.078649199999973 871.093564284 L 217.3692788988281 871.093564284 L 226.4164684188281 862.0463747639999 L 226.4164684188281 852.9991852439999 L 15.078649199999973 852.9991852439999" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="30.157298399999974" y="865.062104604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1562.5411557882812 1251.075524124 L 2260.5400349553124 1251.075524124 L 2260.5400349553124 1484.794586724 L 1562.5411557882812 1484.794586724 L 1562.5411557882812 1251.075524124 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1562.5411557882812 1251.075524124 L 1562.5411557882812 1269.1699031639998 L 1764.8317854871093 1269.1699031639998 L 1773.8789750071094 1260.122713644 L 1773.8789750071094 1251.075524124 L 1562.5411557882812 1251.075524124" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1577.6198049882812" y="1263.138443484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment</text></g></g></g></svg>