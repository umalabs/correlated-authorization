<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2449" height="1961"><desc>participant%20%22AuthZ%20Server%20%E2%80%93%20Requesting%20Party%20(AS-RqP)%22%20as%20AS-RqP%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22AuthZ%20Server%20%E2%80%93%20Resource%20Owner%20(AS-RO)%22%20as%20AS-RO%0A%0Abottomparticipants%0A%0Anote%20over%20AS-RqP%3AAS-RqP%3A%5Cn%E2%80%A2%20URI%20and%20domain%20part%20of%20the%20RqP's%20email%20address%20must%20match%5Cn%E2%80%A2%20provides%20an%20STS%20service%20that%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0Anote%20over%20Client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20AS-RqP%20as%20a%20public%20or%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20Relying%20Party%20in%20respect%20of%20the%20RqP's%20Identity%20Provider%20in%20order%20to%20obtain%20an%20access_token_with_user_claims%5Cn%E2%80%A2%20is%20registered%20at%20AS-RO%20as%20a%20public%20or%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20token%20propagator%20between%20the%20AS-RqP%20and%20AS-RO%0Anote%20over%20RS%3ARO%3A%5Cn%E2%80%A2%20has%20set%20up%20the%20RS%2C%20registers%20the%20resources%20at%20the%20AS-RO%20and%20sets%20policies%0Anote%20over%20AS-RO%3AAS-RO%3A%5Cn%E2%80%A2%20URI%20and%20domain%20part%20of%20the%20RO's%20email%20address%20must%20match%5Cn%E2%80%A2%20provides%20an%20STS%20service%20that%20supports%20the%20Token%20Exchange%20extension%20of%20OAuth%202.0%0ARS%3C-Client%3A1.%20Send%20an%20HTTP%20request%20to%20the%20resource%20URI%20with%20no%20access%20token%0ARS-%3EAS-RO%3A2.%20Request%20a%20permission_ticket%20and%20resource_claims_token%5Cn%7BPAT%7D%0Anote%20over%20AS-RO%3A%20AS-RO%20generates%20the%20permission_ticket%20(a%20JWT%20with%20a%20random%20NONCE%20value%20in%20the%20sub%20claim)%5Cnand%20the%20resource_claims_token%20which%20is%20bound%20to%20the%20permission_ticket%20through%20the%20permission_ticket%20sub%20claim%20hash.%5CnThe%20resource_claims_token%20contains%20these%20claims%3A%5Cn%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%7D%5Cniss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20resource_claims_token%5Cnaud%20is%20the%20URI%20that%20identifies%20the%20requested%20resource%5Cnsub%20is%20the%20permission_ticket%20sub%20claim%20hash%20computed%20as%20Base64URL-Encode(SHA256(permission_ticket%7Bsub%7D)%5Cnexp%2C%20nbf%20are%20the%20standard%20JWT%20claims)%0ARS%3C-AS-RO%3A3.%20Return%20the%20permission_ticket%2C%20resource_claims_token%2C%5Cn%20%20%20%20issued_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%0ARS-%3EClient%3A4.%20Return%20401%20with%20the%20permission_ticket%2C%20resource_claims_token%2C%5Cn%20%20%20%20issued_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%0AAS-RqP%3C-Client%3A5.%20Request%20an%20identity_claims_token%5Cn%20%20%20%20%7Bgrant_type%20%3D%20token-exchange%2C%5Cn%20%20%20%20%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%2C%5Cn%20%20%20%20%20resource%20%3D%20(RO's%20email%20address%20URI)%20%E2%80%94%20optional%5Cn%20%20%20%20%20subject_token%20%3D%20access_token_with_user_claims%2C%5Cn%20%20%20%20%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%2C%5Cn%20%20%20%20%20actor_token%20%3D%20resource_claims_token%2C%5Cn%20%20%20%20%20actor_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%7D%0Anote%20over%20AS-RqP%3AAuthorization%20assessment%3A%5Cn1.%20verify%20the%20subject_token%20signature%5Cn2.%20evaluate%20the%20subject_token%20claims%5Cn3.%20verify%20the%20actor_token%20signature%5Cn4.%20evaluate%20the%20actor%20claims%20%5Cn5.%20verify%20the%20resource%20parameter%20value%20%E2%80%94%20optional%0Anote%20over%20AS-RqP%3AAS-RqP%20generates%20the%20identity_claims_token%20with%20these%20claims%3A%5Cn%7Biss%2C%20aud%2C%20sub%2C%20exp%2C%20nbf%2C%20act%7Bsub%7D%7D%5Cniss%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20identity_claims_token%5Cnaud%20identifies%20the%20target%20service%20and%20it%20is%20the%20iss%20claim%20value%20extracted%20from%20the%20actor_token%5Cnsub%20identifies%20the%20RqP%20by%20email%20address%20and%20was%20extracted%20from%20the%20access_token_with_user_claims%5Cnexp%2C%20nbf%20are%20the%20standard%20JWT%20claims%5Cnact%7Baud%7D%20is%20the%20the%20resource%20parameter%20value%20%E2%80%94%20optional%5Cnact%7Bsub%7D%20is%20the%20sub%20value%20extracted%20from%20the%20actor_token%5Cn%0AClient%3C-AS-RqP%3A6.%20Return%20the%20identity_claims_token%20in%20the%20access_token%20parameter%2C%5Cn%20%20%20%20issued_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%0A%0AClient-%3EAS-RO%3A7.%20Request%20an%20access_token%5Cn%20%20%20%20%7Bgrant_type%20%3D%20token-exchange%2C%5Cn%20%20%20%20%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%2C%5Cn%20%20%20%20%20subject_token%20%3D%20permission_ticket%2C%5Cn%20%20%20%20%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%2C%5Cn%20%20%20%20%20actor_token%20%3D%20identity_claims_token%2C%5Cn%20%20%20%20%20actor_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%7D%0Anote%20over%20AS-RO%3AAuthorization%20assessment%3A%5Cn1.%20verify%20the%20permission%20ticket%20signature%5Cn2.%20evaluate%20the%20permission_ticket%20claims%5Cn3.%20verify%20the%20actor_token%20signature%5Cn4.%20evaluate%20the%20actor%20claims%5Cn5.%20actor_token%7Bact%7Baud%7D%7D%20and%20the%20RO's%20email%20address%20URI%20must%20match%20%E2%80%94%20optional%5Cn6.%20actor_token%7Bact%7Bsub%7D%7D%20and%20Base64URL-Encode(SHA256(permission_ticket%7Bsub%7D))%20must%20match%0Anote%20over%20AS-RO%3AAS-RO%20generates%20the%20access_token%20with%20missing%20sub%20claim%20(the%20RqP%20is%20not%20signed%20in%2C%5Cnthe%20client%20acts%20on%20behalf%20of%20RqP)%20and%20with%20these%20additional%20claims%3A%5Cn%7Bact%7Baud%7D%2C%20act%7Bsub%7D%7D%5Cnact%7Baud%7D%20is%20the%20RO's%20email%20address%20URI%5Cnact%7Bsub%7D%20is%20the%20sub%20value%20extracted%20from%20actor_token%20(RqP's%20email%20address)%0AClient%3C-AS-RO%3A8.%20Return%20the%20access_token%2C%20optionally%20a%20refresh_token%0ARS%3C-Client%3A9.%20Send%20an%20HTTP%20request%20to%20the%20resource%20URI%20with%20access_token%5Cn%20%20%20%20%7Baccess_token%7D%0ARS-%3EClient%3A10.%20Return%20the%20HTTP%20response%2C%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2449" height="1961"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 395.3244212729687 50.815047804 L 395.3244212729687 1908.5046292440002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 974.0008272776562 50.815047804 L 974.0008272776562 1908.5046292440002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1500.2939019835155 50.815047804 L 1500.2939019835155 1908.5046292440002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1987.4869705858591 50.815047804 L 1987.4869705858591 1908.5046292440002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 225.14742124155467 10.253481456000003 L 565.5014213043828 10.253481456000003 L 565.5014213043828 50.815047804 L 225.14742124155467 50.815047804 L 225.14742124155467 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="241.50775562355466" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 936.3904928956562 10.253481456000003 L 1011.6111616596562 10.253481456000003 L 1011.6111616596562 50.815047804 L 936.3904928956562 50.815047804 L 936.3904928956562 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="952.7508272776562" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1406.0668989003436 10.253481456000003 L 1594.5209050666874 10.253481456000003 L 1594.5209050666874 50.815047804 L 1406.0668989003436 50.815047804 L 1406.0668989003436 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1422.4272332823436" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1822.9766423073747 10.253481456000003 L 2151.9972988643435 10.253481456000003 L 2151.9972988643435 50.815047804 L 1822.9766423073747 50.815047804 L 1822.9766423073747 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1839.3369766893748" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 225.14742124155467 1908.5046292440002 L 565.5014213043828 1908.5046292440002 L 565.5014213043828 1949.0661955920002 L 225.14742124155467 1949.0661955920002 L 225.14742124155467 1908.5046292440002 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="241.50775562355466" y="1933.9875463920002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 936.3904928956562 1908.5046292440002 L 1011.6111616596562 1908.5046292440002 L 1011.6111616596562 1949.0661955920002 L 936.3904928956562 1949.0661955920002 L 936.3904928956562 1908.5046292440002 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="952.7508272776562" y="1933.9875463920002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1406.0668989003436 1908.5046292440002 L 1594.5209050666874 1908.5046292440002 L 1594.5209050666874 1949.0661955920002 L 1406.0668989003436 1949.0661955920002 L 1406.0668989003436 1908.5046292440002 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1422.4272332823436" y="1933.9875463920002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1822.9766423073747 1908.5046292440002 L 2151.9972988643435 1908.5046292440002 L 2151.9972988643435 1949.0661955920002 L 1822.9766423073747 1949.0661955920002 L 1822.9766423073747 1908.5046292440002 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1839.3369766893748" y="1933.9875463920002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 65.93098719765625 80.97234620399999 L 711.1470710682812 80.97234620399999 L 724.7178553482812 94.54313048399999 L 724.7178553482812 145.810537764 L 65.93098719765625 145.810537764 L 65.93098719765625 80.97234620399999 M 711.1470710682812 80.97234620399999 L 711.1470710682812 94.54313048399999 L 724.7178553482812 94.54313048399999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="87.04109607765622" y="102.08245508399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="87.04109607765622" y="117.16110428399999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• URI and domain part of the RqP's email address must match</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="87.04109607765622" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• provides an STS service that supports the Token Exchange extension of OAuth 2.0</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 520.1990374894531 168.42851156400002 L 1414.2318327858593 168.42851156400002 L 1427.8026170658593 181.99929584400002 L 1427.8026170658593 263.424001524 L 520.1990374894531 263.424001524 L 520.1990374894531 168.42851156400002 M 1414.2318327858593 168.42851156400002 L 1414.2318327858593 181.99929584400002 L 1427.8026170658593 181.99929584400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="541.3091463694531" y="189.538620444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="541.3091463694531" y="204.617269644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at AS-RqP as a public or confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="541.3091463694531" y="219.695918844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a Relying Party in respect of the RqP's Identity Provider in order to obtain an access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="541.3091463694531" y="234.774568044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at AS-RO as a public or confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="541.3091463694531" y="249.853217244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a token propagator between the AS-RqP and AS-RO</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1205.7171182988282 286.041975324 L 1781.2999013882031 286.041975324 L 1794.8706856682031 299.612759604 L 1794.8706856682031 335.80151768400003 L 1205.7171182988282 335.80151768400003 L 1205.7171182988282 286.041975324 M 1781.2999013882031 286.041975324 L 1781.2999013882031 299.612759604 L 1794.8706856682031 299.612759604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1226.827227178828" y="307.15208420400006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RO:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1226.827227178828" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• has set up the RS, registers the resources at the AS-RO and sets policies</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1658.0935365105468 358.419491484 L 2303.3096203811715 358.419491484 L 2316.8804046611717 371.990275764 L 2316.8804046611717 423.25768304400003 L 1658.0935365105468 423.25768304400003 L 1658.0935365105468 358.419491484 M 2303.3096203811715 358.419491484 L 2303.3096203811715 371.990275764 L 2316.8804046611717 371.990275764" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1679.2036453905466" y="379.5296003640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RO:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1679.2036453905466" y="394.60824956400006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• URI and domain part of the RO's email address must match</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1679.2036453905466" y="409.68689876400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• provides an STS service that supports the Token Exchange extension of OAuth 2.0</text></g><g><g><rect fill="white" stroke="none" x="991.8438954976561" y="445.87565684400005" width="490.60693826585936" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="994.1056928776561" y="459.4464411240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send an HTTP request to the resource URI with no access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 974.0008272776562 465.47790080400006 L 1487.8791474755155 465.47790080400006" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1500.2939019835155,465.47790080400006) translate(-1500.2939019835155,-465.47790080400006)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1487.7283609835156 459.19513030400003 L 1500.2939019835155 465.47790080400006 L 1487.7283609835156 471.7606713040001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1527.603645008203" y="488.0958746040001" width="432.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1527.603645008203" y="503.17452380400005" width="48.973595522939455" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1529.865442388203" y="501.66665888400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Request a permission_ticket and resource_claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1529.865442388203" y="516.745308084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{PAT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1500.2939019835155 522.776767764 L 1975.0722160778591 522.776767764" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1987.4869705858591,522.776767764) translate(-1987.4869705858591,-522.776767764)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1974.9214295858592 516.4939972640001 L 1987.4869705858591 522.776767764 L 1974.9214295858592 529.059538264 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1533.0601807976561 545.3947415640001 L 2428.342976094062 545.3947415640001 L 2441.9137603740623 558.9655258440001 L 2441.9137603740623 685.6261791240001 L 1533.0601807976561 685.6261791240001 L 1533.0601807976561 545.3947415640001 M 2428.342976094062 545.3947415640001 L 2428.342976094062 558.9655258440001 L 2441.9137603740623 558.9655258440001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1554.170289677656" y="566.5048504440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RO generates the permission_ticket (a JWT with a random NONCE value in the sub claim)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1554.170289677656" y="581.5834996440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">and the resource_claims_token which is bound to the permission_ticket through the permission_ticket sub claim hash.</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1554.170289677656" y="596.6621488440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The resource_claims_token contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1554.170289677656" y="611.7407980440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{iss, aud, sub, exp, nbf}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1554.170289677656" y="626.8194472440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">iss is the URI that identifies who issues the resource_claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1554.170289677656" y="641.8980964440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">aud is the URI that identifies the requested resource</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1554.170289677656" y="656.9767456440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sub is the permission_ticket sub claim hash computed as Base64URL-Encode(SHA256(permission_ticket{sub})</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1554.170289677656" y="672.055394844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">exp, nbf are the standard JWT claims)</text></g><g><g><rect fill="white" stroke="none" x="1518.1369702035156" y="708.2441529240002" width="413.8069199553125" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1518.1369702035156" y="723.3228021240002" width="451.50693216234373" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1520.3987675835156" y="721.8149372040002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Return the permission_ticket, resource_claims_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1520.3987675835156" y="736.8935864040002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    issued_token_type = urn:ietf:params:oauth:token-type:jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1987.4869705858591 742.9250460840002 L 1512.7086564915155 742.9250460840002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1500.2939019835155,742.9250460840002) translate(-1500.2939019835155,-742.9250460840002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1512.8594429835155 736.6422755840002 L 1500.2939019835155 742.9250460840002 L 1512.8594429835155 749.2078165840002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="996.0105672505858" y="765.5430198840003" width="482.27359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="996.0105672505858" y="780.6216690840002" width="451.50693216234373" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="998.2723646305858" y="779.1138041640003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return 401 with the permission_ticket, resource_claims_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="998.2723646305858" y="794.1924533640002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    issued_token_type = urn:ietf:params:oauth:token-type:jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1500.2939019835155 800.2239130440003 L 986.4155817856562 800.2239130440003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(974.0008272776562,800.2239130440003) translate(-974.0008272776562,-800.2239130440003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 986.5663682776562 793.9411425440003 L 974.0008272776562 800.2239130440003 L 986.5663682776562 806.5066835440002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="413.16748949296874" y="822.8418868440002" width="269.29025735765623" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="413.16748949296874" y="837.9205360440002" width="255.84026040941407" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="413.16748949296874" y="852.9991852440002" width="487.95691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="413.16748949296874" y="868.0778344440001" width="378.75693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="413.16748949296874" y="883.1564836440001" width="385.85693826585936" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="413.16748949296874" y="898.2351328440001" width="542.9902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="413.16748949296874" y="913.313782044" width="306.70691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="413.16748949296874" y="928.392431244" width="456.29025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="415.42928687296876" y="836.4126711240002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Request an identity_claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="415.42928687296876" y="851.4913203240002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = token-exchange,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="415.42928687296876" y="866.5699695240002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     requested_token_type = urn:ietf:params:oauth:token-type:jwt,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="415.42928687296876" y="881.6486187240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     resource = (RO's email address URI) — optional</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="415.42928687296876" y="896.7272679240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token = access_token_with_user_claims,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="415.42928687296876" y="911.8059171240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token_type = urn:ietf:params:oauth:token-type:access_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="415.42928687296876" y="926.884566324" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     actor_token = resource_claims_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="415.42928687296876" y="941.963215524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     actor_token_type = urn:ietf:params:oauth:token-type:jwt}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 974.0008272776562 947.9946752040003 L 407.7391757809687 947.9946752040003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(395.3244212729687,947.9946752040003) translate(-395.3244212729687,-947.9946752040003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 407.8899622729687 941.7119047040003 L 395.3244212729687 947.9946752040003 L 407.8899622729687 954.2774457040002 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 190.5309780423828 970.6126490040003 L 586.5470802235546 970.6126490040003 L 600.1178645035546 984.1834332840003 L 600.1178645035546 1080.6867881640003 L 190.5309780423828 1080.6867881640003 L 190.5309780423828 970.6126490040003 M 586.5470802235546 970.6126490040003 L 586.5470802235546 984.1834332840003 L 600.1178645035546 984.1834332840003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="211.64108692238278" y="991.7227578840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="211.64108692238278" y="1006.8014070840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify the subject_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="211.64108692238278" y="1021.8800562840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. evaluate the subject_token claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="211.64108692238278" y="1036.9587054840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. verify the actor_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="211.64108692238278" y="1052.0373546840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. evaluate the actor claims </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="211.64108692238278" y="1067.1160038840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify the resource parameter value — optional</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 1103.3047619640001 L 769.5387336659375 1103.3047619640001 L 783.1095179459375 1116.8755462440001 L 783.1095179459375 1258.6148487240002 L 7.5393246000000005 1258.6148487240002 L 7.5393246000000005 1103.3047619640001 M 769.5387336659375 1103.3047619640001 L 769.5387336659375 1116.8755462440001 L 783.1095179459375 1116.8755462440001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1124.4148708440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP generates the identity_claims_token with these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1139.4935200440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{iss, aud, sub, exp, nbf, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1154.5721692440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">iss is the URI that identifies who issues the identity_claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1169.6508184440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">aud identifies the target service and it is the iss claim value extracted from the actor_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1184.7294676440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sub identifies the RqP by email address and was extracted from the access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1199.808116844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">exp, nbf are the standard JWT claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1214.886766044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">act{aud} is the the resource parameter value — optional</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1229.965415244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">act{sub} is the sub value extracted from the actor_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="1245.044064444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"></text></g><g><g><rect fill="white" stroke="none" x="434.54248949296874" y="1281.232822524" width="500.2402695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="434.54248949296874" y="1296.311471724" width="451.50693216234373" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="436.80428687296876" y="1294.803606804" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Return the identity_claims_token in the access_token parameter,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="436.80428687296876" y="1309.882256004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    issued_token_type = urn:ietf:params:oauth:token-type:jwt</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 395.3244212729687 1315.9137156840002 L 961.5860727696562 1315.9137156840002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(974.0008272776562,1315.9137156840002) translate(-974.0008272776562,-1315.9137156840002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 961.4352862776561 1309.6309451840002 L 974.0008272776562 1315.9137156840002 L 961.4352862776561 1322.1964861840002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1198.7737580458984" y="1338.5316894840003" width="208.24025430589845" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1198.7737580458984" y="1353.6103386840002" width="255.84026040941407" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1198.7737580458984" y="1368.6889878840002" width="563.9402817717188" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1198.7737580458984" y="1383.7676370840002" width="283.8736008635156" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1198.7737580458984" y="1398.8462862840001" width="467.00693216234373" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1198.7737580458984" y="1413.9249354840001" width="299.20691385179686" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1198.7737580458984" y="1429.003584684" width="456.29025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.0355554258983" y="1352.1024737640003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Request an access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.0355554258983" y="1367.1811229640002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = token-exchange,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.0355554258983" y="1382.2597721640002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     requested_token_type = urn:ietf:params:oauth:token-type:access_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.0355554258983" y="1397.3384213640002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token = permission_ticket,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.0355554258983" y="1412.4170705640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token_type = urn:ietf:params:oauth:token-type:jwt,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.0355554258983" y="1427.4957197640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     actor_token = identity_claims_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1201.0355554258983" y="1442.574368964" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     actor_token_type = urn:ietf:params:oauth:token-type:jwt}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 974.0008272776562 1448.6058286440002 L 1975.0722160778591 1448.6058286440002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1987.4869705858591,1448.6058286440002) translate(-1987.4869705858591,-1448.6058286440002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1974.9214295858592 1442.3230581440002 L 1987.4869705858591 1448.6058286440002 L 1974.9214295858592 1454.8885991440002 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1607.4935304070311 1471.2238024440003 L 2353.909626484687 1471.2238024440003 L 2367.4804107646873 1484.7945867240003 L 2367.4804107646873 1596.3765908040002 L 1607.4935304070311 1596.3765908040002 L 1607.4935304070311 1471.2238024440003 M 2353.909626484687 1471.2238024440003 L 2353.909626484687 1484.7945867240003 L 2367.4804107646873 1484.7945867240003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1628.603639287031" y="1492.3339113240002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1628.603639287031" y="1507.4125605240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify the permission ticket signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1628.603639287031" y="1522.491209724" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. evaluate the permission_ticket claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1628.603639287031" y="1537.569858924" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. verify the actor_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1628.603639287031" y="1552.648508124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. evaluate the actor claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1628.603639287031" y="1567.727157324" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. actor_token{act{aud}} and the RO's email address URI must match — optional</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1628.603639287031" y="1582.805806524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. actor_token{act{sub}} and Base64URL-Encode(SHA256(permission_ticket{sub})) must match</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1657.8352052117186 1618.9945646040003 L 2303.5679516799996 1618.9945646040003 L 2317.13873596 1632.5653488840003 L 2317.13873596 1713.9900545640003 L 1657.8352052117186 1713.9900545640003 L 1657.8352052117186 1618.9945646040003 M 2303.5679516799996 1618.9945646040003 L 2303.5679516799996 1632.5653488840003 L 2317.13873596 1632.5653488840003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1678.9453140917185" y="1640.1046734840002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RO generates the access_token with missing sub claim (the RqP is not signed in,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1678.9453140917185" y="1655.1833226840001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">the client acts on behalf of RqP) and with these additional claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1678.9453140917185" y="1670.261971884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{act{aud}, act{sub}}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1678.9453140917185" y="1685.340621084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">act{aud} is the RO's email address URI</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1678.9453140917185" y="1700.419270284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">act{sub} is the sub value extracted from actor_token (RqP's email address)</text></g><g><g><rect fill="white" stroke="none" x="1279.248764149414" y="1736.6080283640003" width="402.9902695646875" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1281.510561529414" y="1750.1788126440003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return the access_token, optionally a refresh_token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1987.4869705858591 1756.2102723240002 L 986.4155817856562 1756.2102723240002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(974.0008272776562,1756.2102723240002) translate(-974.0008272776562,-1756.2102723240002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 986.5663682776562 1749.9275018240003 L 974.0008272776562 1756.2102723240002 L 986.5663682776562 1762.4930428240002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1001.9855733541015" y="1778.828246124" width="470.32358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1001.9855733541015" y="1793.906895324" width="139.67358865648438" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1004.2473707341014" y="1792.399030404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Send an HTTP request to the resource URI with access_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1004.2473707341014" y="1807.477679604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {access_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 974.0008272776562 1813.5091392840002 L 1487.8791474755155 1813.5091392840002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1500.2939019835155,1813.5091392840002) translate(-1500.2939019835155,-1813.5091392840002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1487.7283609835156 1807.2263687840002 L 1500.2939019835155 1813.5091392840002 L 1487.7283609835156 1819.7919097840002 Z"/></g></g><g><g><rect fill="white" stroke="none" x="992.0439077046874" y="1836.1271130840003" width="490.20691385179686" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="994.3057050846874" y="1849.6978973640003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return the HTTP response, typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1500.2939019835155 1855.7293570440002 L 986.4155817856562 1855.7293570440002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(974.0008272776562,1855.7293570440002) translate(-974.0008272776562,-1855.7293570440002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 986.5663682776562 1849.4465865440002 L 974.0008272776562 1855.7293570440002 L 986.5663682776562 1862.0121275440001 Z"/></g></g></g></g></svg>