<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2387" height="1807"><desc>participant%20%22AuthZ%20Server%20%E2%80%93%20Requesting%20Party%20(AS-RqP)%22%20as%20AS-RqP%0Aparticipant%20%22Client%22%20as%20Client%0Aparticipant%20%22Resource%20Server%20(RS)%22%20as%20RS%0Aparticipant%20%22AuthZ%20Server%20%E2%80%93%20Resource%20Owner%20(AS-RO)%22%20as%20AS-RO%0A%0Abottomparticipants%0A%0Anote%20over%20AS-RqP%3AAS-RqP%3A%5Cn%E2%80%A2%20supports%20the%20token%20exchange%20extension%20of%20OAuth2%5Cn%E2%80%A2%20publishes%20its%20metadata%20on%20a%20URL%20%2F.well-known%2Foauth-authorization-server%5Cn%E2%80%A2%20also%20acts%20as%20RqP's%20Identity%20Provider%0Anote%20over%20Client%3AClient%3A%5Cn%E2%80%A2%20is%20registered%20at%20AS-RqP%20as%20a%20public%20or%20confidential%20client%5Cn%E2%80%A2%20acts%20as%20a%20Relying%20Party%20in%20a%20RqP's%20Identity%20Provider%20in%20order%20to%20obtain%20an%20an%20access_token_with_user_claims%5Cn%E2%80%A2%20is%20registered%20at%20AS-RO%20as%20a%20public%20or%20confidential%20client%0Anote%20over%20RS%3ARO%20has%20set%20up%20RS%20and%20registers%20his%20resource%20at%20AS-RO%20to%20get%20resource_uri%20and%20sets%20policies%5Cnto%20the%20resource%20sets%20with%20the%20authorization%20server%20to%20indicate%20who%20can%20access%20the%20resources.%0ARS%3C-Client%3A1.%20Send%20HTTP%20request%20to%20resource_uri%20with%20no%20access%20token%0ARS-%3EAS-RO%3A2.%20Request%20a%20permission%20ticket%5Cn%7BPAT%7D%0Anote%20over%20AS-RO%3A%20AS-RO%20generates%20the%20permission%20ticket%20itself%20(ticket%20is%20a%20random%20NONCE)%20and%20the%20permission%20token%2C%5Cnwhich%20is%20bound%20to%20the%20permission%20ticket%20through%20a%20permission%20ticket%20hash.%5CnThe%20permission%20token%20contains%20these%20claims%3A%5Cn%7Bissuer%2C%20ts%2C%20audience%2C%20email_address%2C%20resource_uri_hash%2C%20permission_ticket_hash%7D%5Cnwhere%5Cnissuer%20is%20the%20URI%20that%20identifies%20who%20issues%20the%20permission%20token%5Cnts%20is%20the%20timestamp%20of%20when%20the%20permission%20ticket%20was%20created%5Cnaudience%20is%20the%20URI%20that%20identifies%20the%20resource%20server%5Cnemail_address%20is%20the%20email%20address%20of%20the%20resource%20owner%5Cnresource_uri_hash%20%3D%20Base64URL-Encode(SHA256(resource_uri))%5Cnpermission_ticket_hash%20%3D%20Base64URL-Encode(SHA256(permission_ticket))%0ARS%3C-AS-RO%3A3.%20Return%20the%20permission%20ticket%20and%20the%20permission%20token%0ARS-%3EClient%3A4.%20Return%20401%20with%20the%20permission%20ticket%20and%20the%20permission%20token%0AAS-RqP%3C-Client%3A5.%20Request%20a%20claims%20token%20(token%20exchange%20request)%5Cn%20%20%20%20%7Bgrant_type%20%3D%20token-exchange%2C%5Cn%20%20%20%20%20resource%20%3D%20resource_uri%2C%5Cn%20%20%20%20%20scope%20%3D%20permission_token%2C%5Cn%20%20%20%20%20subject_token%20%3D%20access_token_with_user_claims%2C%5Cn%20%20%20%20%20subject_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Aaccess_token%2C%5Cn%20%20%20%20%20requested_token_type%20%3D%20urn%3Aietf%3Aparams%3Aoauth%3Atoken-type%3Ajwt%7D%0Agroup%20Authorization%20assessment%0Anote%20over%20AS-RqP%3A1.%20verify%20permission_token%20signature%5Cn2.%20extract%20resource_uri_hash%20claim%20from%20permission_token%5Cn3.%20compare%20resource_uri_hash%20vs.%20Base64URL-Encode(SHA256(resource_uri))%5Cn4.%20evaluate%20provenance%20of%20the%20resource%20URI%20using%20issuer%2C%20ts%2C%20audience%2C%20email_address%2C%20resource_uri%20claims%0Aend%0Anote%20over%20AS-RqP%3AAS-RqP%20generates%20the%20claim%20token%2C%20which%20contains%20these%20claims%3A%5Cn%7Buser_claims%2C%20permission_ticket_hash%7D%5Cnwhere%5Cnuser_claims%20are%20extracted%20from%20access_token_with_user_claims%5Cnpermission_ticket_hash%20is%20extracted%20from%20permission_token%0AClient%3C-AS-RqP%3A6.%20Return%20claims%20token%5Cn%20%20%20%20%7Bclaims_token%7D%0A%0AClient-%3EAS-RO%3A7.%20Request%20a%20Requesting%20Party%20Token%20(RPT)%5Cn%20%20%20%20%7Bgrant_type%20%3D%20uma-ticket%2C%5Cn%20%20%20%20%20ticket%20%3D%20ticket%2C%5Cn%20%20%20%20%20pushed_claims%20%3D%20claims_token%7D%0Agroup%20Authorization%20assessment%0Anote%20over%20AS-RO%3A1.%20verify%20permission_ticket%5Cn2.%20extract%20user_claims%20from%20claims_token%5Cn3.%20select%20email_address%20claim%5Cn4.%20bootstrap%20discovery%20of%20AS-RqP%20config%20url%20from%20email%20address%20via%20WebFinger%3B%5Cn%20%20%20%20if%20this%20doesn't%20work%2C%20build%20well-known%20url%20using%20domain%20part%20of%20email_address%5Cn5.%20verify%20claims_token%20signature%5Cn6.%20evaluate%20resource_uri%5Cn7.%20extract%20permission_ticket_hash%20claim%20from%20claims_token%5Cn8.%20compare%20permission_ticket_hash%20vs.%20Base64URL-Encode(SHA256(permission_ticket))%5Cn9.%20evaluate%20user_claims%0Aend%0AClient%3C-AS-RO%3A8.%20Return%20RPT%5Cn%20%20%20%20%7BRPT%7D%0ARS%3C-Client%3A9.%20Send%20HTTP%20request%20to%20resource_uri%5Cn%20%20%20%20%7BRPT%7D%0ARS-%3EClient%3A10.%20Return%20HTTP%20response%20typically%20with%20200%2C%20201%20status%20code%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2387" height="1807"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 432.4364261858593 50.815047804 L 432.4364261858593 1754.7024074040003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1011.1128321905468 50.815047804 L 1011.1128321905468 1754.7024074040003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1537.589225988203 50.815047804 L 1537.589225988203 1754.7024074040003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1995.5989449811718 50.815047804 L 1995.5989449811718 1754.7024074040003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 262.25942615444524 10.253481456000003 L 602.6134262172734 10.253481456000003 L 602.6134262172734 50.815047804 L 262.25942615444524 50.815047804 L 262.25942615444524 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="278.61976053644526" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 973.5024978085468 10.253481456000003 L 1048.7231665725467 10.253481456000003 L 1048.7231665725467 50.815047804 L 973.5024978085468 50.815047804 L 973.5024978085468 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="989.8628321905468" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1443.362222905031 10.253481456000003 L 1631.816229071375 10.253481456000003 L 1631.816229071375 50.815047804 L 1443.362222905031 50.815047804 L 1443.362222905031 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1459.7225572870311" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1831.0886167026874 10.253481456000003 L 2160.109273259656 10.253481456000003 L 2160.109273259656 50.815047804 L 1831.0886167026874 50.815047804 L 1831.0886167026874 10.253481456000003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1847.4489510846875" y="35.736398604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 262.25942615444524 1754.7024074040003 L 602.6134262172734 1754.7024074040003 L 602.6134262172734 1795.2639737520003 L 262.25942615444524 1795.2639737520003 L 262.25942615444524 1754.7024074040003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="278.61976053644526" y="1780.1853245520003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Requesting Party (AS-RqP)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 973.5024978085468 1754.7024074040003 L 1048.7231665725467 1754.7024074040003 L 1048.7231665725467 1795.2639737520003 L 973.5024978085468 1795.2639737520003 L 973.5024978085468 1754.7024074040003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="989.8628321905468" y="1780.1853245520003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1443.362222905031 1754.7024074040003 L 1631.816229071375 1754.7024074040003 L 1631.816229071375 1795.2639737520003 L 1443.362222905031 1795.2639737520003 L 1443.362222905031 1754.7024074040003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1459.7225572870311" y="1780.1853245520003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Resource Server (RS)</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1831.0886167026874 1754.7024074040003 L 2160.109273259656 1754.7024074040003 L 2160.109273259656 1795.2639737520003 L 1831.0886167026874 1795.2639737520003 L 1831.0886167026874 1754.7024074040003 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1847.4489510846875" y="1780.1853245520003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthZ Server – Resource Owner (AS-RO)</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 136.4429860070312 80.972346204 L 714.8590820846874 80.972346204 L 728.4298663646874 94.543130484 L 728.4298663646874 160.889186964 L 136.4429860070312 160.889186964 L 136.4429860070312 80.972346204 M 714.8590820846874 80.972346204 L 714.8590820846874 94.543130484 L 728.4298663646874 94.543130484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="157.5530948870312" y="102.082455084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="157.5530948870312" y="117.161104284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• supports the token exchange extension of OAuth2</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="157.5530948870312" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• publishes its metadata on a URL /.well-known/oauth-authorization-server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="157.5530948870312" y="147.318402684" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• also acts as RqP's Identity Provider</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 592.4110485058593 183.507160764 L 1416.2438315952343 183.507160764 L 1429.8146158752343 197.077945044 L 1429.8146158752343 263.424001524 L 592.4110485058593 263.424001524 L 592.4110485058593 183.507160764 M 1416.2438315952343 183.507160764 L 1416.2438315952343 197.077945044 L 1429.8146158752343 197.077945044" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="613.5211573858593" y="204.617269644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="613.5211573858593" y="219.695918844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at AS-RqP as a public or confidential client</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="613.5211573858593" y="234.774568044" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• acts as a Relying Party in a RqP's Identity Provider in order to obtain an an access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="613.5211573858593" y="249.853217244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">• is registered at AS-RO as a public or confidential client</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1178.4874484070313 286.041975324 L 1883.120219289375 286.041975324 L 1896.691003569375 299.612759604 L 1896.691003569375 335.80151768400003 L 1178.4874484070313 335.80151768400003 L 1178.4874484070313 286.041975324 M 1883.120219289375 286.041975324 L 1883.120219289375 299.612759604 L 1896.691003569375 299.612759604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1199.5975572870311" y="307.15208420400006" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">RO has set up RS and registers his resource at AS-RO to get resource_uri and sets policies</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1199.5975572870311" y="322.23073340400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to the resource sets with the authorization server to indicate who can access the resources.</text></g><g><g><rect fill="white" stroke="none" x="1056.4892256058592" y="358.41949148400005" width="435.72360696703123" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1058.7510229858592" y="371.9902757640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Send HTTP request to resource_uri with no access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1011.1128321905468 378.02173544400006 L 1525.174471480203 378.02173544400006" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1537.589225988203,378.02173544400006) translate(-1537.589225988203,-378.02173544400006)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1525.023684988203 371.73896494400003 L 1537.589225988203 378.02173544400006 L 1525.023684988203 384.3045059440001 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1653.2906239811523" y="400.6397092440001" width="226.60692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1653.2906239811523" y="415.71835844400005" width="48.973595522939455" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1655.5524213611523" y="414.21049352400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Request a permission ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1655.5524213611523" y="429.28914272400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{PAT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1537.589225988203 435.32060240400006 L 1983.1841904731718 435.32060240400006" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1995.5989449811718,435.32060240400006) translate(-1995.5989449811718,-435.32060240400006)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1983.033403981172 429.03783190400003 L 1995.5989449811718 435.32060240400006 L 1983.033403981172 441.6033729040001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1611.0721796070313 457.938576204 L 2366.5549260753123 457.938576204 L 2380.1257103553125 471.509360484 L 2380.1257103553125 643.4059613640001 L 1611.0721796070313 643.4059613640001 L 1611.0721796070313 457.938576204 M 2366.5549260753123 457.938576204 L 2366.5549260753123 471.509360484 L 2380.1257103553125 471.509360484" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="479.048685084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RO generates the permission ticket itself (ticket is a random NONCE) and the permission token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="494.12733428399997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">which is bound to the permission ticket through a permission ticket hash.</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="509.20598348399994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">The permission token contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="524.2846326839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{issuer, ts, audience, email_address, resource_uri_hash, permission_ticket_hash}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="539.3632818839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="554.4419310839999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">issuer is the URI that identifies who issues the permission token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="569.5205802839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ts is the timestamp of when the permission ticket was created</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="584.5992294839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">audience is the URI that identifies the resource server</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="599.6778786839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">email_address is the email address of the resource owner</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="614.7565278839998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">resource_uri_hash = Base64URL-Encode(SHA256(resource_uri))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.1822884870312" y="629.8351770839997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">permission_ticket_hash = Base64URL-Encode(SHA256(permission_ticket))</text></g><g><g><rect fill="white" stroke="none" x="1555.432294208203" y="666.023935164" width="422.32358255296873" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1557.694091588203" y="679.594719444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Return the permission ticket and the permission token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1995.5989449811718 685.626179124 L 1550.003980496203 685.626179124" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1537.589225988203,685.626179124) translate(-1537.589225988203,-685.626179124)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1550.154766988203 679.3434086240001 L 1537.589225988203 685.626179124 L 1550.154766988203 691.908949624 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1028.9559004105467" y="708.244152924" width="490.79025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1031.2176977905467" y="721.814937204" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Return 401 with the permission ticket and the permission token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1537.589225988203 727.846396884 L 1023.5275866985468 727.846396884" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1011.1128321905468,727.846396884) translate(-1011.1128321905468,-727.846396884)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1023.6783731905468 721.563626384 L 1011.1128321905468 727.846396884 L 1023.6783731905468 734.129167384 Z"/></g></g><g><g><rect fill="white" stroke="none" x="450.27949440585934" y="750.4643706840001" width="387.4402512541406" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="450.27949440585934" y="765.543019884" width="255.84026040941407" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="450.27949440585934" y="780.621669084" width="207.90692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="450.27949440585934" y="795.700318284" width="225.74025430589845" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="450.27949440585934" y="810.778967484" width="385.85693826585936" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="450.27949440585934" y="825.8576166839999" width="542.9902695646875" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="450.27949440585934" y="840.9362658839999" width="492.6236008635156" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.54129178585936" y="764.0351549640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Request a claims token (token exchange request)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.54129178585936" y="779.113804164" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = token-exchange,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.54129178585936" y="794.192453364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     resource = resource_uri,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.54129178585936" y="809.271102564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     scope = permission_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.54129178585936" y="824.349751764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token = access_token_with_user_claims,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.54129178585936" y="839.4284009639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     subject_token_type = urn:ietf:params:oauth:token-type:access_token,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="452.54129178585936" y="854.5070501639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     requested_token_type = urn:ietf:params:oauth:token-type:jwt}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1011.1128321905468 860.538509844 L 444.8511806938593 860.538509844" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(432.4364261858593,860.538509844) translate(-432.4364261858593,-860.538509844)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 445.0019671858593 854.2557393440001 L 432.4364261858593 860.538509844 L 445.0019671858593 866.821280344 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 22.617973799999973 923.868836484 L 828.6840942917187 923.868836484 L 842.2548785717187 937.439620764 L 842.2548785717187 1003.785677244 L 22.617973799999973 1003.785677244 L 22.617973799999973 923.868836484 M 828.6840942917187 923.868836484 L 828.6840942917187 937.439620764 L 842.2548785717187 937.439620764" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="944.978945364" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify permission_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="960.0575945639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. extract resource_uri_hash claim from permission_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="975.1362437639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. compare resource_uri_hash vs. Base64URL-Encode(SHA256(resource_uri))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="43.72808267999994" y="990.2148929639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. evaluate provenance of the resource URI using issuer, ts, audience, email_address, resource_uri claims</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 175.55965470820308 1049.0216248440001 L 675.7424133835156 1049.0216248440001 L 689.3131976635156 1062.5924091240001 L 689.3131976635156 1144.0171148040001 L 175.55965470820308 1144.0171148040001 L 175.55965470820308 1049.0216248440001 M 675.7424133835156 1049.0216248440001 L 675.7424133835156 1062.5924091240001 L 689.3131976635156 1062.5924091240001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="196.66976358820307" y="1070.131733724" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AS-RqP generates the claim token, which contains these claims:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="196.66976358820307" y="1085.210382924" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">{user_claims, permission_ticket_hash}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="196.66976358820307" y="1100.289032124" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">where</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="196.66976358820307" y="1115.367681324" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">user_claims are extracted from access_token_with_user_claims</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="196.66976358820307" y="1130.446330524" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">permission_ticket_hash is extracted from permission_token</text></g><g><g><rect fill="white" stroke="none" x="637.0711661587891" y="1166.635088604" width="169.40692605882813" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="637.0711661587891" y="1181.713737804" width="137.39026346117188" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="639.332963538789" y="1180.205872884" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Return claims token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="639.332963538789" y="1195.284522084" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {claims_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 432.4364261858593 1201.315981764 L 998.6980776825468 1201.315981764" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1011.1128321905468,1201.315981764) translate(-1011.1128321905468,-1201.315981764)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 998.5472911905467 1195.033211264 L 1011.1128321905468 1201.315981764 L 998.5472911905467 1207.598752264 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1345.2190912058593" y="1223.9339555640001" width="316.27359476" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1345.2190912058593" y="1239.0126047640001" width="216.85692300707032" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1345.2190912058593" y="1254.091253964" width="135.45692911058595" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1345.2190912058593" y="1269.169903164" width="262.77359476" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1347.4808885858592" y="1237.5047398440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. Request a Requesting Party Token (RPT)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1347.4808885858592" y="1252.5833890440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {grant_type = uma-ticket,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1347.4808885858592" y="1267.662038244" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     ticket = ticket,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1347.4808885858592" y="1282.740687444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     pushed_claims = claims_token}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1011.1128321905468 1288.7721471240002 L 1983.1841904731718 1288.7721471240002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1995.5989449811718,1288.7721471240002) translate(-1995.5989449811718,-1288.7721471240002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1983.033403981172 1282.4893766240002 L 1995.5989449811718 1288.7721471240002 L 1983.033403981172 1295.0549176240002 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1654.1388299976563 1352.1024737640003 L 2323.4882756846873 1352.1024737640003 L 2337.0590599646875 1365.6732580440002 L 2337.0590599646875 1522.4912097240003 L 1654.1388299976563 1522.4912097240003 L 1654.1388299976563 1352.1024737640003 M 2323.4882756846873 1352.1024737640003 L 2323.4882756846873 1365.6732580440002 L 2337.0590599646875 1365.6732580440002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1373.2125826440003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. verify permission_ticket</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1388.2912318440003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. extract user_claims from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1403.3698810440003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. select email_address claim</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1418.4485302440003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. bootstrap discovery of AS-RqP config url from email address via WebFinger;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1433.5271794440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    if this doesn't work, build well-known url using domain part of email_address</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1448.6058286440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. verify claims_token signature</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1463.6844778440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. evaluate resource_uri</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1478.7631270440002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">7. extract permission_ticket_hash claim from claims_token</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1493.8417762440001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. compare permission_ticket_hash vs. Base64URL-Encode(SHA256(permission_ticket))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1675.2489388776562" y="1508.920425444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. evaluate user_claims</text></g><g><g><rect fill="white" stroke="none" x="1451.0774247935058" y="1567.7271573240002" width="104.55692758470703" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1451.0774247935058" y="1582.8058065240002" width="69.87359323412109" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1453.3392221735057" y="1581.2979416040002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">8. Return RPT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1453.3392221735057" y="1596.3765908040002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {RPT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1995.5989449811718 1602.4080504840003 L 1023.5275866985468 1602.4080504840003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1011.1128321905468,1602.4080504840003) translate(-1011.1128321905468,-1602.4080504840003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1023.6783731905468 1596.1252799840004 L 1011.1128321905468 1602.4080504840003 L 1023.6783731905468 1608.6908209840003 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1135.7725660599608" y="1625.0260242840002" width="277.1569260588281" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="1135.7725660599608" y="1640.1046734840002" width="69.87359323412109" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1138.0343634399608" y="1638.5968085640002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">9. Send HTTP request to resource_uri</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1138.0343634399608" y="1653.6754577640002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    {RPT}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1011.1128321905468 1659.7069174440003 L 1525.174471480203 1659.7069174440003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1537.589225988203,1659.7069174440003) translate(-1537.589225988203,-1659.7069174440003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1525.023684988203 1653.4241469440003 L 1537.589225988203 1659.7069174440003 L 1525.023684988203 1665.9896879440003 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1045.9559004105467" y="1682.3248912440004" width="456.79025735765623" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1048.2176977905467" y="1695.8956755240004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">10. Return HTTP response typically with 200, 201 status code</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1537.589225988203 1701.9271352040003 L 1023.5275866985468 1701.9271352040003" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1011.1128321905468,1701.9271352040003) translate(-1011.1128321905468,-1701.9271352040003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1023.6783731905468 1695.6443647040003 L 1011.1128321905468 1701.9271352040003 L 1023.6783731905468 1708.2099057040002 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 15.078649199999973 883.156483644 L 849.7942031717187 883.156483644 L 849.7942031717187 1026.403651044 L 15.078649199999973 1026.403651044 L 15.078649199999973 883.156483644 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 15.078649199999973 883.156483644 L 15.078649199999973 901.250862684 L 217.3692788988281 901.250862684 L 226.4164684188281 892.203673164 L 226.4164684188281 883.156483644 L 15.078649199999973 883.156483644" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="30.157298399999974" y="895.219403004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1646.5995053976562 1311.3901209240003 L 2344.5983845646874 1311.3901209240003 L 2344.5983845646874 1545.1091835240004 L 1646.5995053976562 1545.1091835240004 L 1646.5995053976562 1311.3901209240003 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1646.5995053976562 1311.3901209240003 L 1646.5995053976562 1329.4844999640002 L 1848.8901350964843 1329.4844999640002 L 1857.9373246164844 1320.4373104440003 L 1857.9373246164844 1311.3901209240003 L 1646.5995053976562 1311.3901209240003" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1661.6781545976562" y="1323.4530402840003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authorization assessment</text></g></g></g></svg>